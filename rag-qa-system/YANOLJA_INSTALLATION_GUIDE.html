<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>야놀자 RAG QA 시스템 설치 가이드</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #FF385C;
            border-bottom: 3px solid #FF385C;
            padding-bottom: 10px;
        }
        h2 {
            color: #2c3e50;
            margin-top: 30px;
            border-left: 4px solid #FF385C;
            padding-left: 10px;
        }
        h3 {
            color: #34495e;
            margin-top: 20px;
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        code {
            background-color: #ecf0f1;
            color: #e74c3c;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        .comment {
            color: #95a5a6;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #FF385C;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .toc h3 {
            margin-top: 0;
            color: #FF385C;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .toc a {
            color: #2c3e50;
            text-decoration: none;
        }
        .toc a:hover {
            color: #FF385C;
            text-decoration: underline;
        }
        .step-number {
            background-color: #FF385C;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .copy-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
            float: right;
            margin-top: -35px;
            margin-right: 5px;
        }
        .copy-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏨 야놀자 RAG QA 시스템 설치 가이드</h1>
        
        <div class="toc">
            <h3>목차</h3>
            <ul>
                <li><a href="#requirements">1. 시스템 요구사항</a></li>
                <li><a href="#packages">2. 기본 패키지 설치</a></li>
                <li><a href="#ollama">3. Ollama LLM 설치</a></li>
                <li><a href="#models">4. 야놀자 모델 설치</a></li>
                <li><a href="#python">5. Python 환경 구성</a></li>
                <li><a href="#service">6. 서비스 설정</a></li>
                <li><a href="#management">7. 운영 관리</a></li>
                <li><a href="#troubleshooting">8. 문제 해결</a></li>
                <li><a href="#local-test">9. 로컬 테스트</a></li>
            </ul>
        </div>

        <h2 id="requirements"><span class="step-number">1</span>시스템 요구사항</h2>
        
        <h3>하드웨어</h3>
        <table>
            <tr>
                <th>구성요소</th>
                <th>최소 사양</th>
                <th>권장 사양</th>
            </tr>
            <tr>
                <td>CPU</td>
                <td>4코어</td>
                <td>8코어 이상</td>
            </tr>
            <tr>
                <td>RAM</td>
                <td>16GB</td>
                <td>32GB</td>
            </tr>
            <tr>
                <td>저장공간</td>
                <td>50GB</td>
                <td>100GB SSD</td>
            </tr>
            <tr>
                <td>OS</td>
                <td>Ubuntu 20.04 LTS</td>
                <td>Ubuntu 22.04 LTS</td>
            </tr>
        </table>

        <h3>소프트웨어</h3>
        <ul>
            <li>Python 3.9 이상</li>
            <li>Redis Server</li>
            <li>Nginx (선택사항)</li>
            <li>Git</li>
        </ul>

        <h2 id="packages"><span class="step-number">2</span>기본 패키지 설치</h2>
        
        <h3>시스템 업데이트</h3>
        <pre><code><span class="comment"># 시스템 패키지 업데이트</span>
sudo apt update && sudo apt upgrade -y</code></pre>
        
        <h3>필수 패키지 설치</h3>
        <pre><code><span class="comment"># 필수 패키지 일괄 설치</span>
sudo apt install -y \
    python3.9 \
    python3.9-venv \
    python3.9-dev \
    python3-pip \
    git \
    curl \
    wget \
    build-essential \
    redis-server \
    nginx \
    supervisor \
    htop \
    net-tools</code></pre>

        <h3>Python 기본 버전 설정</h3>
        <pre><code><span class="comment"># Python 3.9를 기본으로 설정</span>
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 1

<span class="comment"># 버전 확인</span>
python3 --version  <span class="comment"># 3.9.x 확인</span></code></pre>

        <h2 id="ollama"><span class="step-number">3</span>Ollama LLM 설치</h2>
        
        <h3>Ollama 설치</h3>
        <pre><code><span class="comment"># 공식 설치 스크립트 실행</span>
curl -fsSL https://ollama.com/install.sh | sh

<span class="comment"># 설치 확인</span>
ollama --version

<span class="comment"># 서비스 활성화</span>
sudo systemctl enable ollama
sudo systemctl start ollama

<span class="comment"># 서비스 상태 확인</span>
sudo systemctl status ollama</code></pre>

        <div class="info">
            <strong>💡 참고:</strong> Ollama는 백그라운드 서비스로 실행되며, 기본적으로 11434 포트를 사용합니다.
        </div>

        <h3>Ollama 서비스 관리</h3>
        <pre><code><span class="comment"># 서비스 시작</span>
sudo systemctl start ollama

<span class="comment"># 서비스 중지</span>
sudo systemctl stop ollama

<span class="comment"># 서비스 재시작</span>
sudo systemctl restart ollama

<span class="comment"># 로그 확인</span>
sudo journalctl -u ollama -f</code></pre>

        <h2 id="models"><span class="step-number">4</span>야놀자 모델 설치</h2>
        
        <h3>야놀자 특화 모델</h3>
        <table>
            <tr>
                <th>용도</th>
                <th>모델명</th>
                <th>크기</th>
                <th>설명</th>
            </tr>
            <tr>
                <td>여행 상담</td>
                <td>llama3.1:8b-instruct-q4_0</td>
                <td>4.7GB</td>
                <td>여행지, 맛집, 액티비티 추천</td>
            </tr>
            <tr>
                <td>숙박 추천</td>
                <td>qwen2.5:7b-instruct</td>
                <td>4.4GB</td>
                <td>호텔/숙박 특화 추천</td>
            </tr>
            <tr>
                <td>고객서비스</td>
                <td>solar:10.7b-instruct-v1-q4_0</td>
                <td>6GB</td>
                <td>예약/취소/환불 안내</td>
            </tr>
            <tr>
                <td>범용</td>
                <td>llama3.2:3b-instruct-korean</td>
                <td>2GB</td>
                <td>일반 질의응답</td>
            </tr>
        </table>

        <h3>모델 다운로드</h3>
        <pre><code><span class="comment"># 여행 상담 AI 모델</span>
ollama pull llama3.1:8b-instruct-q4_0

<span class="comment"># 숙박 추천 AI 모델</span>
ollama pull qwen2.5:7b-instruct

<span class="comment"># 고객서비스 AI 모델 (메모리 충분시)</span>
ollama pull solar:10.7b-instruct-v1-q4_0

<span class="comment"># 범용 한국어 AI 모델</span>
ollama pull llama3.2:3b-instruct-korean

<span class="comment"># 설치된 모델 확인</span>
ollama list</code></pre>

        <div class="warning">
            <strong>⚠️ 주의:</strong> 모든 모델을 설치하려면 약 20GB의 저장 공간이 필요합니다.
        </div>

        <h3>경량 모델 옵션 (메모리 부족시)</h3>
        <pre><code><span class="comment"># 경량 모델만 설치</span>
ollama pull llama3.2:3b
ollama pull phi3:mini  <span class="comment"># 3.8B 파라미터</span>
ollama pull gemma:2b   <span class="comment"># 2B 파라미터</span></code></pre>

        <h2 id="python"><span class="step-number">5</span>Python 환경 구성</h2>
        
        <h3>프로젝트 디렉토리 생성</h3>
        <pre><code><span class="comment"># 야놀자 전용 디렉토리 생성</span>
sudo mkdir -p /opt/yanolja/rag-system
sudo chown -R $USER:$USER /opt/yanolja
cd /opt/yanolja/rag-system</code></pre>

        <h3>소스코드 배포</h3>
        <pre><code><span class="comment"># Git clone 방식</span>
git clone &lt;repository-url&gt; .

<span class="comment"># 또는 SCP로 파일 전송</span>
scp -r /local/path/to/rag-qa-system/* user@server:/opt/yanolja/rag-system/</code></pre>

        <h3>Python 가상환경 설정</h3>
        <pre><code><span class="comment"># 가상환경 생성</span>
python3 -m venv venv

<span class="comment"># 가상환경 활성화</span>
source venv/bin/activate

<span class="comment"># pip 업그레이드</span>
pip install --upgrade pip wheel setuptools

<span class="comment"># 의존성 설치</span>
pip install -r requirements.txt</code></pre>

        <h3>환경변수 설정</h3>
        <pre><code><span class="comment"># .env 파일 생성</span>
cat > .env << 'EOF'
# 야놀자 프로젝트 설정
PROJECT_NAME=YANOLJA_RAG_SYSTEM
SECRET_KEY=yanolja-secret-key-$(date +%s)
FLASK_DEBUG=False
FLASK_PORT=5000
FLASK_HOST=0.0.0.0

# Ollama 설정
OLLAMA_BASE_URL=http://localhost:11434

# 야놀자 모델 설정
YANOLJA_TRAVEL_MODEL=llama3.1:8b-instruct-q4_0
YANOLJA_HOTEL_MODEL=qwen2.5:7b-instruct
YANOLJA_CS_MODEL=solar:10.7b-instruct-v1-q4_0
YANOLJA_GENERAL_MODEL=llama3.2:3b-instruct-korean

# 벡터 DB 설정
CHROMA_PERSIST_DIRECTORY=/opt/yanolja/rag-system/data/vectordb
CHROMA_COLLECTION_NAME=yanolja_documents

# 문서 처리
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
MAX_FILE_SIZE=52428800

# 야놀자 비즈니스 설정
YANOLJA_API_TIMEOUT=30
YANOLJA_MAX_RETRIES=3
YANOLJA_CACHE_TTL=3600
YANOLJA_MAX_CONCURRENT=4
YANOLJA_STREAMING=True

# 로깅
LOG_LEVEL=INFO
LOG_FILE=/opt/yanolja/logs/yanolja-rag.log
EOF</code></pre>

        <h3>디렉토리 구조 생성</h3>
        <pre><code><span class="comment"># 필수 디렉토리 생성</span>
mkdir -p data/{documents,vectordb}
mkdir -p logs
mkdir -p static
mkdir -p templates

<span class="comment"># 권한 설정</span>
chmod -R 755 data/
chmod -R 755 logs/</code></pre>

        <h2 id="service"><span class="step-number">6</span>서비스 설정</h2>
        
        <h3>Redis 설정</h3>
        <pre><code><span class="comment"># Redis 시작</span>
sudo systemctl enable redis-server
sudo systemctl start redis-server

<span class="comment"># Redis 연결 테스트</span>
redis-cli ping
<span class="comment"># 응답: PONG</span></code></pre>

        <h3>Systemd 서비스 등록</h3>
        <pre><code><span class="comment"># 야놀자 RAG 서비스 파일 생성</span>
sudo tee /etc/systemd/system/yanolja-rag.service << 'EOF'
[Unit]
Description=Yanolja RAG QA System
After=network.target redis.service ollama.service

[Service]
Type=simple
User=$USER
WorkingDirectory=/opt/yanolja/rag-system
Environment="PATH=/opt/yanolja/rag-system/venv/bin"
Environment="PYTHONPATH=/opt/yanolja/rag-system"
ExecStart=/opt/yanolja/rag-system/venv/bin/python app.py
Restart=always
RestartSec=10
StandardOutput=append:/opt/yanolja/logs/yanolja-rag.log
StandardError=append:/opt/yanolja/logs/yanolja-rag-error.log

[Install]
WantedBy=multi-user.target
EOF

<span class="comment"># 서비스 활성화 및 시작</span>
sudo systemctl daemon-reload
sudo systemctl enable yanolja-rag
sudo systemctl start yanolja-rag

<span class="comment"># 서비스 상태 확인</span>
sudo systemctl status yanolja-rag</code></pre>

        <h3>Nginx 리버스 프록시 설정</h3>
        <pre><code><span class="comment"># Nginx 설정 파일 생성</span>
sudo tee /etc/nginx/sites-available/yanolja-rag << 'EOF'
server {
    listen 80;
    server_name your-domain.com;  <span class="comment"># 실제 도메인으로 변경</span>

    client_max_body_size 50M;  <span class="comment"># 파일 업로드 크기 제한</span>

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        <span class="comment"># 타임아웃 설정 (LLM 응답 시간 고려)</span>
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    <span class="comment"># 정적 파일 직접 서빙</span>
    location /static {
        alias /opt/yanolja/rag-system/static;
        expires 1d;
    }
}
EOF

<span class="comment"># 설정 활성화</span>
sudo ln -s /etc/nginx/sites-available/yanolja-rag /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx</code></pre>

        <h2 id="management"><span class="step-number">7</span>운영 관리</h2>
        
        <h3>서비스 모니터링</h3>
        <pre><code><span class="comment"># 실시간 로그 확인</span>
tail -f /opt/yanolja/logs/yanolja-rag.log

<span class="comment"># 시스템 리소스 모니터링</span>
htop

<span class="comment"># Ollama 프로세스 확인</span>
ps aux | grep ollama

<span class="comment"># 메모리 사용량 확인</span>
free -h

<span class="comment"># 디스크 사용량 확인</span>
df -h /opt/yanolja</code></pre>

        <h3>모델 관리</h3>
        <pre><code><span class="comment"># 실행 중인 모델 확인</span>
ollama ps

<span class="comment"># 특정 모델 테스트</span>
ollama run llama3.1:8b-instruct-q4_0 "안녕하세요"

<span class="comment"># 모델 제거 (공간 확보)</span>
ollama rm model-name

<span class="comment"># 모델 정보 확인</span>
ollama show llama3.1:8b-instruct-q4_0</code></pre>

        <h3>백업 및 복구</h3>
        <pre><code><span class="comment"># 벡터 DB 백업</span>
tar -czf vectordb-backup-$(date +%Y%m%d).tar.gz /opt/yanolja/rag-system/data/vectordb

<span class="comment"># 문서 백업</span>
tar -czf documents-backup-$(date +%Y%m%d).tar.gz /opt/yanolja/rag-system/data/documents

<span class="comment"># 전체 백업</span>
tar -czf yanolja-rag-backup-$(date +%Y%m%d).tar.gz /opt/yanolja/rag-system</code></pre>

        <h2 id="troubleshooting"><span class="step-number">8</span>문제 해결</h2>
        
        <h3>일반적인 문제들</h3>
        
        <h4>Ollama 연결 실패</h4>
        <pre><code><span class="comment"># Ollama 서비스 확인</span>
sudo systemctl status ollama

<span class="comment"># 포트 확인</span>
sudo netstat -tlnp | grep 11434

<span class="comment"># 서비스 재시작</span>
sudo systemctl restart ollama</code></pre>

        <h4>메모리 부족</h4>
        <pre><code><span class="comment"># 사용하지 않는 모델 제거</span>
ollama list
ollama rm unused-model

<span class="comment"># 스왑 메모리 추가</span>
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile</code></pre>

        <h4>Python 모듈 오류</h4>
        <pre><code><span class="comment"># 가상환경 재활성화</span>
deactivate
source /opt/yanolja/rag-system/venv/bin/activate

<span class="comment"># 패키지 재설치</span>
pip install --upgrade -r requirements.txt</code></pre>

        <h3>성능 최적화</h3>
        
        <h4>모델 응답 속도 개선</h4>
        <pre><code><span class="comment"># .env 파일에서 동시 요청 수 조정</span>
YANOLJA_MAX_CONCURRENT=2  <span class="comment"># 메모리 부족시 줄이기</span>

<span class="comment"># 캐시 TTL 증가</span>
YANOLJA_CACHE_TTL=7200  <span class="comment"># 2시간</span></code></pre>

        <h4>시스템 튜닝</h4>
        <pre><code><span class="comment"># 파일 디스크립터 제한 증가</span>
echo "* soft nofile 65535" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65535" | sudo tee -a /etc/security/limits.conf

<span class="comment"># 시스템 재시작</span>
sudo reboot</code></pre>

        <h2 id="local-test"><span class="step-number">9</span>로컬 테스트</h2>
        
        <h3>Windows 로컬 테스트</h3>
        <pre><code><span class="comment"># 1. Windows에서 Ollama 설치</span>
<span class="comment"># PowerShell 관리자 권한으로 실행</span>
winget install Ollama.Ollama

<span class="comment"># 또는 https://ollama.com/download/windows 에서 직접 다운로드</span>

<span class="comment"># 2. Ollama 실행 확인</span>
ollama --version

<span class="comment"># 3. 경량 모델 다운로드</span>
ollama pull llama3.2:3b
ollama pull phi3:mini

<span class="comment"># 4. 모델 테스트</span>
ollama run llama3.2:3b "안녕하세요"</code></pre>

        <h3>테스트 스크립트 실행</h3>
        <pre><code><span class="comment"># 환경설정 변경</span>
copy .env .env.backup
copy .env.local .env

<span class="comment"># 테스트 실행</span>
python test_yanolja_local.py

<span class="comment"># 앱 실행</span>
python app.py</code></pre>

        <div class="success">
            <strong>✅ 완료!</strong> 브라우저에서 <code>http://localhost:5000</code>으로 접속하여 테스트하세요.
        </div>

        <h2>빠른 설치 스크립트</h2>
        
        <pre><code>#!/bin/bash
<span class="comment"># install_yanolja_all.sh</span>

set -e

echo "🏨 야놀자 RAG 시스템 전체 설치 시작..."

<span class="comment"># 1. 시스템 패키지 설치</span>
echo "📦 [1/6] 시스템 패키지 설치..."
sudo apt update
sudo apt install -y python3.9 python3.9-venv python3.9-dev python3-pip \
    git curl wget build-essential redis-server nginx supervisor htop net-tools

<span class="comment"># 2. Ollama 설치</span>
echo "🤖 [2/6] Ollama 설치..."
curl -fsSL https://ollama.com/install.sh | sh
sudo systemctl enable ollama
sudo systemctl start ollama

<span class="comment"># 3. 야놀자 모델 다운로드</span>
echo "📥 [3/6] 야놀자 AI 모델 다운로드..."
ollama pull llama3.1:8b-instruct-q4_0
ollama pull qwen2.5:7b-instruct
ollama pull llama3.2:3b-instruct-korean

<span class="comment"># 4. 프로젝트 설정</span>
echo "🔧 [4/6] 프로젝트 설정..."
sudo mkdir -p /opt/yanolja/rag-system
sudo chown -R $USER:$USER /opt/yanolja
cd /opt/yanolja/rag-system

<span class="comment"># 5. Python 환경 구성</span>
echo "🐍 [5/6] Python 환경 구성..."
python3.9 -m venv venv
source venv/bin/activate
pip install --upgrade pip wheel setuptools

<span class="comment"># 6. 서비스 시작</span>
echo "🚀 [6/6] 서비스 시작..."
sudo systemctl start redis
mkdir -p data/{documents,vectordb} logs static templates

echo "✅ 야놀자 RAG 시스템 설치 완료!"
echo "📍 접속 주소: http://localhost:5000"
echo "📚 API 문서: http://localhost:5000/swagger/"</code></pre>

        <h2>설치 후 확인사항</h2>
        
        <div class="info">
            <h4>1. 서비스 상태 확인</h4>
            <pre><code>sudo systemctl status ollama redis yanolja-rag</code></pre>
            
            <h4>2. 웹 인터페이스 접속</h4>
            <ul>
                <li>메인 페이지: <code>http://your-server:5000</code></li>
                <li>API 문서: <code>http://your-server:5000/swagger/</code></li>
            </ul>
            
            <h4>3. 모델 테스트</h4>
            <pre><code>curl -X POST http://localhost:5000/api/yanolja/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "안녕하세요", "model_type": "travel"}'</code></pre>
        </div>

        <hr style="margin-top: 50px;">
        
        <div style="text-align: center; color: #666; padding: 20px 0;">
            <p><strong>야놀자 AI팀</strong></p>
            <p>문서 버전: 1.0.0 | 최종 업데이트: 2024-12-28</p>
        </div>
    </div>

    <script>
        // 코드 블록에 복사 버튼 추가
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('pre');
            
            codeBlocks.forEach(function(block, index) {
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = '복사';
                button.onclick = function() {
                    const code = block.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(function() {
                        button.textContent = '복사됨!';
                        setTimeout(function() {
                            button.textContent = '복사';
                        }, 2000);
                    });
                };
                block.style.position = 'relative';
                block.appendChild(button);
            });
        });
    </script>
</body>
</html>