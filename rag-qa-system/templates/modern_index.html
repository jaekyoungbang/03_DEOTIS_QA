<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BC Card vLLM Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --primary-dark: #5a67d8;
            --secondary-color: #764ba2;
            --success-color: #10a37f;
            --success-dark: #0d8c6b;
            --danger-color: #e53e3e;
            --warning-color: #ffc107;
            --info-color: #3182ce;
            --dark-color: #2d3748;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--gray-700);
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Modern Header */
        .modern-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }
        
        .header-content {
            max-width: 1440px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .brand-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--white);
            box-shadow: var(--shadow-md);
        }
        
        .brand-text {
            line-height: 1.2;
        }
        
        .brand-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
            margin: 0;
        }
        
        .brand-subtitle {
            font-size: 14px;
            color: var(--gray-500);
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .status-indicators {
            display: flex;
            gap: 16px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--gray-100);
            border-radius: 8px;
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .status-item.cache-status {
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: var(--white);
        }
        
        .header-settings-btn {
            width: 40px;
            height: 40px;
            background: var(--gray-100);
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--gray-600);
        }
        
        .header-settings-btn:hover {
            background: var(--gray-200);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* App Layout */
        .app-container {
            max-width: 1440px;
            margin: 0 auto;
            background: var(--white);
            min-height: calc(100vh - 80px);
            box-shadow: var(--shadow-xl);
        }
        
        .app-layout {
            display: flex;
            height: calc(100vh - 80px);
        }
        
        /* Modern Sidebar */
        .sidebar {
            width: 320px;
            background: var(--gray-50);
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .new-chat-btn {
            width: 100%;
            padding: 14px 18px;
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-sm);
        }
        
        .new-chat-btn:hover {
            background: linear-gradient(135deg, var(--success-dark), #0a7c5a);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .chat-history-section {
            flex: 1;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chat-history-list {
            flex: 1;
            overflow-y: auto;
            margin: -4px;
        }
        
        .chat-history-item {
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-history-item:hover {
            background: var(--white);
            border-color: var(--gray-200);
            transform: translateX(2px);
        }
        
        .chat-history-item.active {
            background: linear-gradient(135deg, var(--success-color)08, var(--success-dark)08);
            border-color: var(--success-color);
            box-shadow: var(--shadow-sm);
        }
        
        .chat-history-title {
            color: var(--gray-700);
            font-weight: 500;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .chat-history-time {
            color: var(--gray-400);
            font-size: 12px;
        }
        
        .chat-history-preview {
            color: var(--gray-500);
            font-size: 12px;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .chat-history-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-400);
        }
        
        .chat-history-empty i {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
            color: var(--gray-300);
        }
        
        /* Management Panel */
        .management-panel {
            background: var(--white);
            border-top: 1px solid var(--gray-200);
        }
        
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .tab-btn {
            flex: 1;
            padding: 16px 12px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .tab-btn.active {
            color: var(--success-color);
            background: var(--gray-50);
            border-bottom: 2px solid var(--success-color);
        }
        
        .tab-btn:hover:not(.active) {
            background: var(--gray-50);
            color: var(--gray-700);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }
        
        .modern-select,
        .modern-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: var(--white);
        }
        
        .modern-select:focus,
        .modern-input:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .action-buttons {
            margin-top: 20px;
        }
        
        .primary-btn,
        .danger-btn,
        .upload-btn {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: var(--white);
        }
        
        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .danger-btn {
            background: var(--danger-color);
            color: var(--white);
        }
        
        .danger-btn:hover {
            background: #c53030;
            transform: translateY(-1px);
        }
        
        .upload-btn {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px dashed var(--gray-300);
        }
        
        .upload-btn:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }
        
        .w-full {
            width: 100%;
        }
        
        .upload-section {
            margin-bottom: 20px;
        }
        
        .file-upload {
            margin-top: 12px;
        }
        
        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--white);
            position: relative;
        }
        
        .chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .chat-title h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
            margin: 0;
        }
        
        .chat-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .faq-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .faq-button {
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 13px;
            color: var(--gray-700);
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .faq-button:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
            transform: translateY(-1px);
        }
        
        .settings-container {
            position: relative;
        }
        
        .settings-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--gray-300);
            background: var(--white);
            font-size: 14px;
            color: var(--gray-700);
        }
        
        .settings-toggle:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }
        
        .settings-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 16px;
            min-width: 300px;
            z-index: 1000;
            display: none;
            animation: fadeInDown 0.2s ease;
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-size: 14px;
            color: var(--gray-700);
        }
        
        .setting-control select {
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 13px;
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            background: var(--white);
            overflow-y: auto;
            padding: 24px;
            scroll-behavior: smooth;
        }
        
        .message {
            margin-bottom: 24px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .message-content {
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .user-avatar {
            background: var(--success-color);
            color: var(--white);
        }
        
        .ai-avatar {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }
        
        .message-text {
            flex: 1;
            padding: 0;
            line-height: 1.6;
            color: var(--gray-700);
        }
        
        .user-message .message-text {
            color: var(--white);
            background: var(--success-color);
            padding: 12px 16px;
            border-radius: 16px 16px 4px 16px;
            margin-left: auto;
            max-width: fit-content;
        }
        
        .ai-message .message-text {
            color: var(--gray-700);
            background: transparent;
        }
        
        /* Chat Actions Bar */
        .chat-actions-bar {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-50);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        
        .faq-section {
            flex: 1;
        }
        
        .faq-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .faq-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            color: var(--gray-700);
            white-space: nowrap;
        }
        
        .faq-btn:hover {
            background: var(--success-color);
            border-color: var(--success-color);
            color: var(--white);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .faq-icon {
            font-size: 14px;
        }
        
        .faq-text {
            font-weight: 500;
        }
        
        .settings-section {
            display: flex;
            align-items: center;
        }
        
        .quick-settings {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-label {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .quick-select {
            padding: 6px 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 12px;
            background: var(--white);
            min-width: 100px;
        }
        
        .quick-select:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.1);
        }
        
        .clear-btn {
            width: 32px;
            height: 32px;
            background: var(--success-color);
            color: var(--white);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .clear-btn:hover {
            background: var(--success-dark);
            transform: scale(1.05);
        }

        /* Chat Input */
        .chat-input-area {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
            background: var(--white);
            position: sticky;
            bottom: 0;
        }
        
        .chat-input-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            min-height: 56px;
            max-height: 200px;
            padding: 16px 60px 16px 20px;
            border: 1px solid var(--gray-300);
            border-radius: 28px;
            resize: none;
            font-size: 16px;
            line-height: 1.5;
            outline: none;
            transition: all 0.2s;
            background: var(--white);
        }
        
        .chat-input:focus {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }
        
        .send-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 20px;
            background: var(--success-color);
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .send-button:hover {
            background: var(--success-dark);
            transform: translateY(-50%) scale(1.05);
        }
        
        .send-button:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: translateY(-50%);
        }
        
        /* Floating Actions */
        .floating-actions {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }
        
        .floating-btn {
            width: 50px;
            height: 50px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--gray-600);
            box-shadow: var(--shadow-lg);
            transition: all 0.2s;
        }
        
        .floating-btn:hover {
            background: var(--gray-50);
            color: var(--gray-700);
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: -320px;
                top: 80px;
                height: calc(100vh - 80px);
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .app-layout::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .app-layout.sidebar-open::before {
                opacity: 1;
                visibility: visible;
            }
            
            .faq-buttons {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                padding: 12px 16px;
            }
            
            .brand-title {
                font-size: 20px;
            }
            
            .status-indicators {
                display: none;
            }
            
            .chat-container {
                padding: 16px;
            }
            
            .chat-input-area {
                padding: 16px;
            }
            
            .chat-actions-bar {
                flex-direction: column;
                gap: 12px;
                padding: 12px 16px;
            }
            
            .faq-buttons {
                justify-content: center;
                gap: 6px;
            }
            
            .faq-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .faq-text {
                display: none;
            }
            
            .quick-settings {
                gap: 12px;
            }
            
            .setting-label {
                font-size: 12px;
            }
            
            .quick-select {
                min-width: 80px;
                font-size: 11px;
            }
        }
        
        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--gray-200);
            border-top: 2px solid var(--success-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Cache Indicator */
        .cache-indicator {
            display: inline-block;
            background: linear-gradient(135deg, var(--warning-color), #ff9800);
            color: var(--white);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Document Alert Styles */
        .document-alert {
            margin: 20px 24px;
            background: linear-gradient(135deg, var(--warning-color), #ff9800);
            border-radius: 12px;
            padding: 20px;
            color: var(--white);
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.5s ease;
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .alert-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .alert-text h4 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .alert-text p {
            margin: 0 0 16px 0;
            opacity: 0.9;
        }

        .alert-btn {
            background: var(--white);
            color: var(--warning-color);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-btn:hover {
            background: var(--gray-100);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Admin Modal Styles */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .admin-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-xl);
            position: relative;
        }

        .admin-modal h3 {
            margin: 0 0 8px 0;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-modal p {
            margin: 0 0 24px 0;
            color: var(--gray-600);
        }

        .admin-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }

        .admin-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .admin-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn.primary {
            background: var(--success-color);
            color: var(--white);
        }

        .admin-btn.primary:hover {
            background: var(--success-dark);
            transform: translateY(-1px);
        }

        .admin-btn.secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .admin-btn.secondary:hover {
            background: var(--gray-300);
        }

        .close-modal {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray-400);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        /* Chat Delete Styles */
        .chat-content {
            flex: 1;
            min-width: 0;
            cursor: pointer;
        }

        .chat-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: all 0.2s;
        }

        .chat-history-item:hover .chat-actions {
            opacity: 1;
        }

        .delete-btn {
            width: 24px;
            height: 24px;
            background: var(--danger-color);
            color: var(--white);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            position: relative;
        }

        .delete-btn:hover {
            background: #c53030;
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.9);
        }

        /* Clear All Button */
        .clear-all-section {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
        }

        .clear-all-btn {
            width: 100%;
            padding: 10px 16px;
            background: var(--gray-100);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .clear-all-btn:hover {
            background: var(--danger-color);
            color: var(--white);
        }

        /* Delete Confirmation Modal */
        .delete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            animation: fadeIn 0.3s ease;
        }

        .delete-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-xl);
            text-align: center;
        }

        .delete-modal h3 {
            margin: 0 0 16px 0;
            color: var(--danger-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .delete-modal p {
            margin: 0 0 24px 0;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .delete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .delete-confirm-btn {
            padding: 10px 20px;
            background: var(--danger-color);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .delete-confirm-btn:hover {
            background: #c53030;
        }

        .delete-cancel-btn {
            padding: 10px 20px;
            background: var(--gray-200);
            color: var(--gray-700);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .delete-cancel-btn:hover {
            background: var(--gray-300);
        }

        /* Admin Panel Styles */
        .admin-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9998;
            display: none;
            backdrop-filter: blur(4px);
        }

        .admin-panel-overlay.show {
            display: block;
        }

        .admin-panel-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .admin-panel-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .admin-panel-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-panel-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .admin-panel-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .admin-panel-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .admin-panel-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .admin-login-section {
            text-align: center;
            padding: 20px;
        }

        .admin-login-section input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
            transition: border-color 0.2s;
        }

        .admin-login-section input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .admin-section {
            margin-bottom: 24px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }

        .admin-section h4 {
            margin: 0 0 16px 0;
            color: var(--gray-800);
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-section .description {
            color: var(--gray-600);
            font-size: 14px;
            margin-bottom: 16px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
        }

        .setting-item label {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .setting-item select,
        .setting-item input {
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .setting-item select:focus,
        .setting-item input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .admin-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 120px;
        }

        .admin-btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .admin-btn-primary:hover {
            background: var(--primary-dark);
        }

        .admin-btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .admin-btn-danger:hover {
            background: #c53030;
        }

        .admin-btn-warning {
            background: var(--warning-color);
            color: var(--gray-800);
        }

        .admin-btn-warning:hover {
            background: #e6b800;
        }

        .admin-btn-info {
            background: var(--info-color);
            color: white;
        }

        .admin-btn-info:hover {
            background: #2c5aa0;
        }

        .admin-btn-success {
            background: var(--success-color);
            color: white;
        }

        .admin-btn-success:hover {
            background: var(--success-dark);
        }

        .admin-settings-trigger {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .admin-settings-trigger:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .cache-settings-btn {
            background: none;
            border: none;
            color: var(--gray-500);
            margin-left: 8px;
            padding: 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .cache-settings-btn:hover {
            color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- Modern Header -->
    <header class="modern-header">
        <div class="header-content">
            <div class="brand">
                <div class="brand-icon">ü§ñ</div>
                <div class="brand-text">
                    <h1 class="brand-title">BC Card vLLM Assistant</h1>
                    <p class="brand-subtitle">Intelligent Document Q&A System</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="status-indicators">
                    <div class="status-item">
                        <i class="fas fa-database"></i>
                        <span id="vectorDbInfoHeader">Î°úÎî©Ï§ë...</span>
                    </div>
                    <div class="status-item cache-status">
                        <i class="fas fa-memory"></i>
                        <span>Hybrid Cache Active</span>
                        <button class="cache-settings-btn" onclick="openAdminSettings()" title="ÏãúÏä§ÌÖú ÏÑ§Ï†ï">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="app-container">
        <div class="app-layout" id="appLayout">
            <!-- Modern Sidebar -->
            <aside class="sidebar" id="sidebar">
                <!-- New Chat Button -->
                <div class="sidebar-header">
                    <button class="new-chat-btn" onclick="startNewChat()">
                        <i class="fas fa-plus"></i>
                        <span>ÏÉà Ï±ÑÌåÖ</span>
                    </button>
                </div>
                
                <!-- Chat History -->
                <div class="chat-history-section">
                    <div class="section-header">
                        <i class="fas fa-history"></i>
                        <span>ÏµúÍ∑º ÎåÄÌôî</span>
                    </div>
                    <div class="chat-history-list" id="chatHistoryList">
                        <!-- Chat sessions will be loaded here -->
                    </div>
                    <!-- Clear All Button -->
                    <div class="clear-all-section">
                        <button class="clear-all-btn" onclick="showClearAllConfirm()">
                            <i class="fas fa-trash-alt"></i>
                            <span>Ï†ÑÏ≤¥ ÎåÄÌôî ÏÇ≠Ï†ú</span>
                        </button>
                    </div>
                </div>
                
                <!-- Management Panel (Hidden) -->
                <div class="management-panel" style="display: none;">
                    <div class="panel-tabs">
                        <button class="tab-btn active" onclick="switchManagementTab('system')" data-tab="system">
                            <i class="fas fa-cog"></i>
                            <span>ÏãúÏä§ÌÖú</span>
                        </button>
                        <button class="tab-btn" onclick="switchManagementTab('documents')" data-tab="documents">
                            <i class="fas fa-folder"></i>
                            <span>Î¨∏ÏÑú</span>
                        </button>
                    </div>
                    
                    <!-- Settings Info -->
                    <div class="tab-content active" id="systemTab">
                        <div class="info-box">
                            <h4>‚öôÔ∏è ÏãúÏä§ÌÖú ÏÑ§Ï†ï</h4>
                            <p>AI Î™®Îç∏, Ï≤≠ÌÅ¨ ÌÅ¨Í∏∞ Îì±Ïùò ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏùÄ Í¥ÄÎ¶¨Ïûê Ìå®ÎÑêÏóêÏÑú Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                            <button class="modern-btn" onclick="openAdminSettings()" style="width: 100%; margin-top: 10px;">
                                Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï Ïó¥Í∏∞
                            </button>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="danger-btn" onclick="clearVectorDB()">
                                <i class="fas fa-trash"></i>
                                <span>Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî</span>
                            </button>
                            <button class="danger-btn" onclick="clearRDBCache()" style="background: var(--warning-color);">
                                <i class="fas fa-database"></i>
                                <span>RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî</span>
                            </button>
                            <button class="danger-btn" onclick="clearAllCache()" style="background: var(--danger-color);">
                                <i class="fas fa-fire"></i>
                                <span>Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Documents Tab -->
                    <div class="tab-content" id="documentsTab">
                        <div class="upload-section">
                            <button class="primary-btn w-full" id="s3LoadBtn" onclick="loadS3Documents()">
                                <i class="fas fa-cloud-download-alt"></i>
                                <span>S3 Î¨∏ÏÑú Î°úÎìú</span>
                            </button>
                            
                            <div class="file-upload">
                                <input type="file" id="fileInput" accept=".pdf,.txt,.docx,.md" hidden onchange="uploadDocument()">
                                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-upload"></i>
                                    <span>ÌååÏùº ÏóÖÎ°úÎìú</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="document-status" id="documentList">
                            <!-- Documents will be loaded here -->
                        </div>
                        
                        <div class="action-buttons">
                            <button class="danger-btn" onclick="clearAllDocuments()">
                                <i class="fas fa-trash"></i>
                                <span>Î™®Îì† Î¨∏ÏÑú ÏÇ≠Ï†ú</span>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Chat Area -->
            <main class="main-content">
                <!-- Simple Chat Header -->
                <div class="chat-header">
                    <div class="chat-title">
                        <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h3>ü§ñ BC Card vLLM Assistant</h3>
                    </div>
                </div>
                
                <!-- Document Status Alert -->
                <div id="documentAlert" class="document-alert" style="display: none;">
                    <div class="alert-content">
                        <div class="alert-icon">üìÑ</div>
                        <div class="alert-text">
                            <h4>Î¨∏ÏÑú Î°úÎî©Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§</h4>
                            <p>AI ÏßàÎ¨∏ ÏùëÎãµÏùÑ ÏúÑÌï¥ÏÑúÎäî Î®ºÏ†Ä S3ÏóêÏÑú Î¨∏ÏÑúÎ•º Î°úÎî©Ìï¥Ïïº Ìï©ÎãàÎã§.</p>
                            <button class="alert-btn" onclick="loadS3Documents()">
                                <i class="fas fa-download"></i> S3 Î¨∏ÏÑú Î°úÎî©ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Container -->
                <div class="chat-container" id="chatContainer">
                    <!-- Messages will be loaded here -->
                </div>
                
                <!-- FAQ and Settings Bar Above Input -->
                <div class="chat-actions-bar">
                    <!-- FAQ Quick Buttons -->
                    <div class="faq-section">
                        <div class="faq-buttons">
                            <button class="faq-btn" onclick="askQuestion('Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂úÏù¥ÎûÄ?')">
                                <span class="faq-icon">üí≥</span>
                                <span class="faq-text">Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú</span>
                            </button>
                            <button class="faq-btn" onclick="askQuestion('Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú Ïù¥Ïö©Î∞©Î≤ï')">
                                <span class="faq-icon">üí∞</span>
                                <span class="faq-text">Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú</span>
                            </button>
                            <button class="faq-btn" onclick="askQuestion('Ïπ¥Îìú Ìï†Î∂Ä ÏàòÏàòÎ£å')">
                                <span class="faq-icon">üìä</span>
                                <span class="faq-text">Ìï†Î∂Ä ÏàòÏàòÎ£å</span>
                            </button>
                            <button class="faq-btn" onclick="askQuestion('Ïã†Ïö©Í≥µÏó¨Í∏∞Í∞ÑÏù¥ÎûÄ')">
                                <span class="faq-icon">üìÖ</span>
                                <span class="faq-text">Ïã†Ïö©Í≥µÏó¨Í∏∞Í∞Ñ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="settings-section">
                        <div class="quick-settings">
                            <div class="setting-item">
                                <label class="setting-label">Î™®Îç∏</label>
                                <select id="llmModelQuick" class="quick-select" onchange="syncLLMModel()">
                                    <option value="gpt-4o-mini">GPT-4o Mini</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="setting-label" title="Ïù¥Ï†Ñ ÏßàÎ¨∏Îì§ÏùÑ Í∏∞ÏñµÌïòÏó¨ Ïó∞ÏÜçÎêú ÎåÄÌôîÍ∞Ä Í∞ÄÎä•Ìï©ÎãàÎã§. Ïòà: 'Í∑∏ Í∏àÎ¶¨Îäî?' ‚Üí Ïù¥Ï†Ñ ÏßàÎ¨∏Ïùò Îß•ÎùΩÏùÑ Ïù¥Ìï¥">
                                    <input type="checkbox" id="useMemoryQuick" onchange="syncMemorySettings()">
                                    <span>Í∏∞Î°ù ÏÇ¨Ïö© <i class="fas fa-info-circle" style="color: var(--info-color); font-size: 12px;"></i></span>
                                </label>
                            </div>
                            <button class="clear-btn" onclick="clearChat()" title="ÏÉà Ï±ÑÌåÖ ÏãúÏûë">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-area">
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="questionInput" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." onkeypress="handleKeyPress(event)" rows="1"></textarea>
                        <button class="send-button" onclick="sendQuestion()" id="sendButton" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" id="deleteModal">
        <div class="delete-modal-content">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                <span id="deleteModalTitle">Ï±ÑÌåÖ ÏÇ≠Ï†ú</span>
            </h3>
            <p id="deleteModalMessage">Ïù¥ Ï±ÑÌåÖÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            
            <div class="delete-buttons">
                <button class="delete-cancel-btn" onclick="closeDeleteModal()">Ï∑®ÏÜå</button>
                <button class="delete-confirm-btn" onclick="confirmDelete()" id="deleteConfirmBtn">
                    <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <button class="close-modal" onclick="closeAdminModal()">√ó</button>
            <h3>
                <i class="fas fa-shield-alt"></i>
                Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù
            </h3>
            <p>S3 Î¨∏ÏÑú Î°úÎî© Î∞è ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏùÑ ÏúÑÌï¥ Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
            
            <input type="password" id="adminPassword" class="admin-input" 
                   placeholder="Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•" 
                   onkeypress="handleAdminKeyPress(event)">
            
            <div class="admin-buttons">
                <button class="admin-btn secondary" onclick="closeAdminModal()">Ï∑®ÏÜå</button>
                <button class="admin-btn primary" onclick="adminLogin()">
                    <i class="fas fa-key"></i> Ïù∏Ï¶ù
                </button>
            </div>
            
            <div id="adminError" style="color: var(--danger-color); margin-top: 12px; display: none;"></div>
        </div>
    </div>

    <!-- Quick Access -->
    <div class="floating-actions">
        <a href="/swagger/" class="floating-btn api-btn" target="_blank" title="API Î¨∏ÏÑú Î≥¥Í∏∞">
            <i class="fas fa-code"></i>
        </a>
    </div>

    <!-- Include existing admin modal and scripts -->
    <!-- ... (admin modal content from original file) ... -->
    
    <script>
        // Chat Session Management
        let currentChatId = null;
        let chatSessions = {};
        let sessionCounter = 1;
        let searchCounter = 0; // Í≤ÄÏÉâ ÌöüÏàò Ïπ¥Ïö¥ÌÑ∞
        let isLoading = false;
        
        window.onload = function() {
            loadDocumentList();
            loadVectorDBInfo();
            setupTextareaAutoResize();
            loadChatHistory();
            startNewChat();
            checkDocumentStatus(); // Î¨∏ÏÑú Î°úÎî© ÏÉÅÌÉú ÌôïÏù∏
        };

        // Chat Session Functions
        function startNewChat() {
            // Í∏∞Ï°¥ Ï±ÑÌåÖ Ï†ÄÏû•
            if (currentChatId && chatSessions[currentChatId]) {
                saveChatSession(currentChatId);
            }
            
            // ÏÉà Ï±ÑÌåÖ ID ÏÉùÏÑ±
            currentChatId = 'chat_' + Date.now();
            
            // ÏÉà Ï±ÑÌåÖ ÏÑ∏ÏÖò ÏÉùÏÑ±
            chatSessions[currentChatId] = {
                id: currentChatId,
                title: 'ÏÉà Ï±ÑÌåÖ',
                messages: [],
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            // Ï±ÑÌåÖ Ïª®ÌÖåÏù¥ÎÑà Ï¥àÍ∏∞Ìôî
            document.getElementById('chatContainer').innerHTML = 
                `<div class="message ai-message">
                    <div class="message-content">
                        <div class="message-avatar ai-avatar">ü§ñ</div>
                        <div class="message-text">
                            <h3>‚úÖ BC Card vLLM Assistant Ï§ÄÎπÑ ÏôÑÎ£å!</h3>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin: 12px 0;">
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
                                    <div><strong>üìÑ Î¨∏ÏÑú ÏÉÅÌÉú:</strong> <span style="color: var(--success-color);">Î°úÎî© ÏôÑÎ£å</span></div>
                                    <div><strong>üß© Ï≤òÎ¶¨Îêú Ï≤≠ÌÅ¨:</strong> 2,847Í∞ú</div>
                                    <div><strong>ü§ñ AI Î™®Îç∏:</strong> ÏÇ¨ÎÇ¥ÏÑúÎ≤Ñ vLLM</div>
                                    <div><strong>üîç Í≤ÄÏÉâ ÏóîÏßÑ:</strong> ÌôúÏÑ±Ìôî</div>
                                </div>
                            </div>
                            <p><strong>üí° ÏÇ¨Ïö©Î≤ï:</strong></p>
                            <ul>
                                <li>üì± <strong>FAQ Î≤ÑÌäº</strong> ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò</li>
                                <li>‚úèÔ∏è <strong>ÏßÅÏ†ë ÏßàÎ¨∏</strong> ÏûÖÎ†•ÌïòÏÑ∏Ïöî</li>
                            </ul>
                            <p><em>ÏòàÏãú: "Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂úÏù¥ÎûÄ?", "Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú Ïù¥Ïö©Î∞©Î≤ï", "Ïπ¥Îìú Ìï†Î∂Ä ÏàòÏàòÎ£åÎäî?"</em></p>
                        </div>
                    </div>
                </div>`;
            
            // Ï±ÑÌåÖ Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateChatHistory();
            
            // Ï£ºÏùò: Î©îÎ™®Î¶¨Îßå Ï¥àÍ∏∞Ìôî, Redis Ï∫êÏãúÎäî Ïú†ÏßÄÌïòÏó¨ Î™®Îì† ÏÇ¨Ïö©ÏûêÍ∞Ä Í≥µÏú†
            fetch('/api/chat/clear-memory', { method: 'POST' });
        }
        
        function saveChatSession(chatId) {
            if (!chatSessions[chatId]) return;
            
            const chatContainer = document.getElementById('chatContainer');
            const messages = Array.from(chatContainer.children);
            
            chatSessions[chatId].messages = messages.map(msg => ({
                content: msg.innerHTML,
                className: msg.className,
                timestamp: new Date()
            }));
            
            chatSessions[chatId].updatedAt = new Date();
            
            // Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄÎ°ú Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            const firstUserMessage = messages.find(msg => msg.classList.contains('user-message'));
            if (firstUserMessage && chatSessions[chatId].title === 'ÏÉà Ï±ÑÌåÖ') {
                const text = firstUserMessage.textContent || firstUserMessage.innerText;
                chatSessions[chatId].title = text.length > 30 ? text.substring(0, 30) + '...' : text;
            }
            
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            localStorage.setItem('chatSessions', JSON.stringify(chatSessions));
        }
        
        function loadChatSession(chatId) {
            if (!chatSessions[chatId]) return;
            
            // Í∏∞Ï°¥ Ï±ÑÌåÖ Ï†ÄÏû•
            if (currentChatId && currentChatId !== chatId) {
                saveChatSession(currentChatId);
            }
            
            currentChatId = chatId;
            const session = chatSessions[chatId];
            
            // Ï±ÑÌåÖ Ïª®ÌÖåÏù¥ÎÑàÏóê Î©îÏãúÏßÄ Î≥µÏõê
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            session.messages.forEach(msgData => {
                const messageDiv = document.createElement('div');
                messageDiv.className = msgData.className;
                messageDiv.innerHTML = msgData.content;
                chatContainer.appendChild(messageDiv);
            });
            
            // Ïä§ÌÅ¨Î°§ ÌïòÎã®ÏúºÎ°ú
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Ï±ÑÌåÖ Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateChatHistory();
        }
        
        function loadChatHistory() {
            const saved = localStorage.getItem('chatSessions');
            if (saved) {
                chatSessions = JSON.parse(saved);
                
                // Date Í∞ùÏ≤¥Î°ú Î≥ÄÌôò
                Object.keys(chatSessions).forEach(id => {
                    chatSessions[id].createdAt = new Date(chatSessions[id].createdAt);
                    chatSessions[id].updatedAt = new Date(chatSessions[id].updatedAt);
                });
            }
            updateChatHistory();
        }
        
        function updateChatHistory() {
            const historyList = document.getElementById('chatHistoryList');
            const sessions = Object.values(chatSessions)
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            if (sessions.length === 0) {
                historyList.innerHTML = `
                    <div class="chat-history-empty">
                        <i class="fas fa-comments"></i>
                        ÏïÑÏßÅ Ï±ÑÌåÖ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.
                    </div>`;
                return;
            }
            
            historyList.innerHTML = sessions.map(session => {
                const isActive = session.id === currentChatId;
                const timeStr = formatChatTime(session.updatedAt);
                const preview = getChatPreview(session.messages);
                
                return `
                    <div class="chat-history-item ${isActive ? 'active' : ''}">
                        <div class="chat-content" onclick="loadChatSession('${session.id}')">
                            <div class="chat-history-title">${session.title}</div>
                            <div class="chat-history-time">${timeStr}</div>
                            ${preview ? `<div class="chat-history-preview">${preview}</div>` : ''}
                        </div>
                        <div class="chat-actions">
                            <button class="delete-btn" onclick="showDeleteConfirm('${session.id}', '${session.title}')" title="Ï±ÑÌåÖ ÏÇ≠Ï†ú">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>`;
            }).join('');
        }
        
        function formatChatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'Î∞©Í∏à Ï†Ñ';
            if (minutes < 60) return `${minutes}Î∂Ñ Ï†Ñ`;
            if (hours < 24) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            if (days < 7) return `${days}Ïùº Ï†Ñ`;
            
            return date.toLocaleDateString('ko-KR', {
                month: 'short',
                day: 'numeric'
            });
        }
        
        function getChatPreview(messages) {
            const lastAiMessage = messages.slice().reverse().find(msg => 
                msg.className && msg.className.includes('ai-message'));
            
            if (!lastAiMessage) return null;
            
            const text = lastAiMessage.content.replace(/<[^>]*>/g, '').trim();
            return text.length > 50 ? text.substring(0, 50) + '...' : text;
        }
        
        function switchManagementTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        function clearChat() {
            startNewChat();
        }
        
        function askQuestion(question) {
            if (isLoading) return;
            
            const input = document.getElementById('questionInput');
            input.value = question;
            sendQuestion();
        }
        
        // Chat settings functions
        function toggleChatSettings() {
            const dropdown = document.getElementById('chatSettingsDropdown');
            const chevron = document.getElementById('settingsChevron');
            
            if (dropdown.style.display === 'none' || !dropdown.style.display) {
                dropdown.style.display = 'block';
                chevron.style.transform = 'rotate(180deg)';
            } else {
                dropdown.style.display = 'none';
                chevron.style.transform = 'rotate(0deg)';
            }
        }
        
        function syncLLMModel() {
            const quickModel = document.getElementById('llmModelQuick');
            const leftPanelModel = document.getElementById('llmModel');
            
            if (quickModel && leftPanelModel) {
                leftPanelModel.value = quickModel.value;
            }
        }
        
        function syncMemorySettings() {
            const quickMemory = document.getElementById('useMemoryQuick');
            const leftPanelMemory = document.getElementById('useMemory');
            
            if (quickMemory && leftPanelMemory) {
                leftPanelMemory.checked = quickMemory.checked;
            }
        }
        
        function syncFromSidebar() {
            const leftPanelModel = document.getElementById('llmModel');
            const leftPanelMemory = document.getElementById('useMemory');
            const quickModel = document.getElementById('llmModelQuick');
            const quickMemory = document.getElementById('useMemoryQuick');
            
            if (leftPanelModel && quickModel) {
                quickModel.value = leftPanelModel.value;
            }
            
            if (leftPanelMemory && quickMemory) {
                quickMemory.checked = leftPanelMemory.checked;
            }
        }
        
        // Auto-resize textarea
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('questionInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 200) + 'px';
                
                // Enable/disable send button based on content
                const sendButton = document.getElementById('sendButton');
                sendButton.disabled = !this.value.trim();
            });
            
            // Initialize button state
            document.getElementById('sendButton').disabled = true;
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey && !isLoading) {
                event.preventDefault();
                sendQuestion();
            }
        }
        
        async function sendQuestion() {
            if (isLoading) return;
            
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            if (!question) return;

            // ÏãúÏûë ÏãúÍ∞Ñ Ï∏°Ï†ï
            const startTime = performance.now();
            isLoading = true;
            const chatContainer = document.getElementById('chatContainer');
            const useMemoryQuick = document.getElementById('useMemoryQuick');
            const useMemory = useMemoryQuick ? useMemoryQuick.checked : false;
            const llmModelQuick = document.getElementById('llmModelQuick');
            const llmModel = llmModelQuick ? llmModelQuick.value : 'gpt-4o-mini';

            // Add user message
            chatContainer.innerHTML += `
                <div class="message user-message">
                    <div class="message-content">
                        <div class="message-avatar user-avatar">You</div>
                        <div class="message-text">${question}</div>
                    </div>
                </div>`;
            
            // Add loading indicator
            chatContainer.innerHTML += `
                <div class="message ai-message" id="loadingMsg">
                    <div class="message-content">
                        <div class="message-avatar ai-avatar">AI</div>
                        <div class="message-text"><div class="loading"></div> ÏÉùÍ∞ÅÌïòÎäî Ï§ë...</div>
                    </div>
                </div>`;
            
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('sendButton').disabled = true;
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                const response = await fetch('/api/rag/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        question: question,
                        use_memory: useMemory,
                        llm_model: llmModel
                    })
                });

                const data = await response.json();
                
                // ÏùëÎãµ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                // Î∞±ÏóîÎìú ÏãúÍ∞ÑÏù¥ ÏóÜÏúºÎ©¥ ÌîÑÎ°†Ìä∏ÏóîÎìú ÏãúÍ∞Ñ ÏÇ¨Ïö©
                if (!data.performance?.total_time_ms) {
                    if (!data.performance) data.performance = {};
                    data.performance.total_time_ms = responseTime;
                }
                
                // Remove loading message
                document.getElementById('loadingMsg').remove();
                
                if (data.error) {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">AI</div>
                                <div class="message-text">
                                    <h3>üö® Ïò§Î•ò Î∞úÏÉù</h3>
                                    <p>${data.error}</p>
                                </div>
                            </div>
                        </div>`;
                } else {
                    const formattedAnswer = formatMarkdown(data.answer);
                    let aiMessage = `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">AI</div>
                                <div class="message-text">
                                    ${formattedAnswer}`;
                    
                    // Add search source indicator (Ìï≠ÏÉÅ ÌëúÏãú)
                    if (data._cache_source || data._from_cache !== undefined) {
                        let sourceText = '';
                        let sourceColor = '';
                        let searchInfo = '';
                        
                        if (data._cache_source === 'RDB') {
                            sourceText = `üéØ RDB Ïù∏Í∏∞ÏßàÎ¨∏`;
                            sourceColor = 'linear-gradient(135deg, #4f46e5, #7c3aed)';
                            searchInfo = `ÏòÅÍµ¨Ï†ÄÏû• | Ï°∞ÌöåÏàò: ${data._hit_count || 0}Ìöå`;
                        } else if (data._cache_source === 'Redis') {
                            sourceText = `‚ö° Redis Ï∫êÏãú`;
                            sourceColor = 'linear-gradient(135deg, #f59e0b, #ea580c)';
                            searchInfo = `ÏûÑÏãúÏ†ÄÏû• | Redis Ï°∞Ìöå: ${data._redis_hit_count || 0}Ìöå`;
                        } else if (data._cache_source === 'RAG') {
                            sourceText = `üîç RAG Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ`;
                            sourceColor = 'linear-gradient(135deg, #10b981, #059669)';
                            searchInfo = 'ÏÉàÎ°úÏö¥ ÏßàÎ¨∏';
                        }
                        
                        // Í≤ÄÏÉâ ÌöüÏàò Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                        if (data._search_count) {
                            searchInfo += ` | Ï¥ù ${data._search_count}Î≤àÏß∏ Í≤ÄÏÉâ`;
                        }
                        
                        aiMessage += `<div class="cache-indicator" style="background: ${sourceColor};">
                            ${sourceText} | ${searchInfo}
                        </div>`;
                        
                        // Ï∂îÍ∞Ä ÎÖ∏Ìä∏Í∞Ä ÏûàÏúºÎ©¥ ÌëúÏãú
                        if (data._note) {
                            aiMessage += `<div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">
                                üìù ${data._note}
                            </div>`;
                        }
                    }
                    
                    // Add similarity search panel if available
                    if (data.similarity_search && data.similarity_search.top_matches && data.similarity_search.top_matches.length > 0) {
                        aiMessage += renderSimilarityPanel(data.similarity_search, question);
                    }
                    
                    aiMessage += `
                                    <div style="margin-top: 10px;">
                                        <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; font-size: 12px; color: var(--gray-600);">
                                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 8px;">
                                                <div><strong>‚è±Ô∏è</strong> ${getProcessingTimeDisplay(data)}</div>
                                                <div><strong>ü§ñ</strong> ${data.system_info?.llm_model || data.model_used || llmModel}</div>
                                                <div><strong>üîç</strong> ${data.similarity_search?.total_results || 0}Í∞ú Îß§Ïπò</div>
                                                <div><strong>üíæ</strong> ${data._from_cache ? 'Ï∫êÏãú ÏùëÎãµ' : 'Ïã§ÏãúÍ∞Ñ Ï≤òÎ¶¨'}</div>
                                                <div><strong>üìä</strong> ${data.search_metadata?.vector_db_size || 0}Í∞ú Î¨∏ÏÑú</div>
                                                <div><strong>üîó</strong> ${data.system_info?.vector_db || 'ChromaDB'}</div>
                                                <div><strong>üî¢</strong> ${++searchCounter}Î≤àÏß∏ Í≤ÄÏÉâ</div>
                                                <div title="Ï∫êÏãúÏóêÏÑú Î∞îÎ°ú ÏùëÎãµÌïú ÏßàÎ¨∏ ÎπÑÏú® (ÎÜíÏùÑÏàòÎ°ù Îπ†Î•∏ ÏùëÎãµ)"><strong>üìà</strong> Ï∫êÏãúÏ†ÅÏ§ëÎ•† ${data._from_cache ? '100' : (data.search_metadata?.cache_hit_rate || '0')}%</div>
                                            </div>
                                            ${data.performance ? `
                                            <div style="border-top: 1px solid var(--gray-200); padding-top: 8px; margin-top: 8px;">
                                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; font-size: 11px; color: var(--gray-500);">
                                                    <div>RAG: ${data.performance.rag_search_time_ms || 0}ms</div>
                                                    <div>LLM: ${data.performance.llm_response_time_ms || 0}ms</div>
                                                    <div>Ï∫êÏãú: ${data.performance.cache_lookup_time_ms || 0}ms</div>
                                                    <div>ÌòÑÏû¨: ${data.performance.total_time_ms || 0}ms</div>
                                                </div>
                                                ${data._from_cache && data.performance.original_total_time_ms ? `
                                                <div style="margin-top: 4px; font-size: 10px; color: var(--gray-400);">
                                                    ÏõêÎ≥∏ Ï≤òÎ¶¨ÏãúÍ∞Ñ: ${data.performance.original_total_time_ms}ms
                                                </div>
                                                ` : ''}
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    
                    chatContainer.innerHTML += aiMessage;
                    
                    // Ï±ÑÌåÖ ÏÑ∏ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    if (currentChatId && chatSessions[currentChatId]) {
                        if (chatSessions[currentChatId].title === 'ÏÉà Ï±ÑÌåÖ') {
                            chatSessions[currentChatId].title = question.length > 30 ? question.substring(0, 30) + '...' : question;
                            updateChatHistory();
                        }
                        chatSessions[currentChatId].updatedAt = new Date();
                    }
                }
            } catch (error) {
                document.getElementById('loadingMsg').remove();
                chatContainer.innerHTML += `
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">AI</div>
                            <div class="message-text">‚ùå Ïó∞Í≤∞ Ïò§Î•ò: ${error.message}</div>
                        </div>
                    </div>`;
            }

            isLoading = false;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Ï±ÑÌåÖ ÏÑ∏ÏÖò Ï†ÄÏû•
            if (currentChatId) {
                saveChatSession(currentChatId);
                updateChatHistory();
            }
        }
        
        // Enhanced markdown formatting with table conversion
        function formatMarkdown(text) {
            // Convert markdown tables to HTML tables
            text = convertMarkdownTables(text);
            
            // Basic markdown formatting
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            text = text.replace(/\n\n/g, '</p><p>');
            text = '<p>' + text + '</p>';
            text = text.replace(/<p><\/p>/g, '');
            return text;
        }
        
        // Get processing time display
        function getProcessingTimeDisplay(data) {
            // Ï∫êÏãúÏóêÏÑú Ïò® Í≤ΩÏö∞ - ÌòÑÏû¨ ÏãúÍ∞ÑÍ≥º Ï∫êÏãú ÏÜåÏöîÏãúÍ∞Ñ ÌëúÏãú
            if (data._from_cache) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    hour12: true
                });
                const cacheTime = data.performance?.cache_lookup_time_ms || data.performance?.total_time_ms || 0;
                return `Ï∫êÏãú ${timeStr}(ÏÜåÏöîÏãúÍ∞Ñ ${Math.round(cacheTime)}ms)`;
            }
            // Ïã§ÏãúÍ∞Ñ RAG Ï≤òÎ¶¨ - performance Ï†ïÎ≥¥Í∞Ä ÏûàÏúºÎ©¥ Ï¥ù ÏãúÍ∞Ñ ÌëúÏãú
            else if (data.performance?.total_time_ms) {
                const timeMs = data.performance.total_time_ms;
                return `ÏÜåÏöîÏãúÍ∞Ñ ${Math.round(timeMs)}ms`;
            }
            // Í∏∞Ï°¥ processing_time ÌïÑÎìú ÏÇ¨Ïö©
            else if (data.processing_time) {
                return `ÏÜåÏöîÏãúÍ∞Ñ ${data.processing_time}Ï¥à`;
            }
            // RAG Ï≤òÎ¶¨ÎêòÏóàÏßÄÎßå ÏãúÍ∞Ñ Ï†ïÎ≥¥Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
            else if (!data._from_cache && data.similarity_search?.total_results > 0) {
                return 'ÏÜåÏöîÏãúÍ∞Ñ 0ms';
            }
            else {
                return 'N/A';
            }
        }
        
        // Convert markdown tables to HTML tables
        function convertMarkdownTables(text) {
            // Find markdown tables (lines starting with |)
            const tableRegex = /(\|[^\n]+\|\n)+/g;
            
            return text.replace(tableRegex, function(match) {
                const lines = match.trim().split('\n');
                if (lines.length < 2) return match;
                
                let html = '<div style="margin: 16px 0; overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">';
                
                lines.forEach((line, index) => {
                    // Skip separator line (usually second line with --- )
                    if (line.includes('---') || line.includes('===')) return;
                    
                    const cells = line.split('|').filter(cell => cell.trim() !== '').map(cell => cell.trim());
                    if (cells.length === 0) return;
                    
                    if (index === 0) {
                        // Header row
                        html += '<thead><tr>';
                        cells.forEach(cell => {
                            html += `<th style="padding: 12px 16px; background: #f8f9fa; border-bottom: 2px solid #e9ecef; font-weight: 600; text-align: left; color: #495057;">${cell}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                    } else {
                        // Data row
                        html += '<tr>';
                        cells.forEach(cell => {
                            html += `<td style="padding: 12px 16px; border-bottom: 1px solid #e9ecef; color: #6c757d;">${cell}</td>`;
                        });
                        html += '</tr>';
                    }
                });
                
                html += '</tbody></table></div>';
                return html;
            });
        }
        
        function renderSimilarityPanel(similarityData, query) {
            let panel = `<div style="background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 12px; padding: 16px; margin: 16px 0;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-weight: 600; color: var(--gray-700); font-size: 14px;">
                    <i class="fas fa-search" style="color: var(--success-color);"></i>
                    Ïú†ÏÇ¨ÎèÑ Í≤ÄÏÉâ Í≤∞Í≥º (${similarityData.total_results}Í∞ú Ï§ë ÏÉÅÏúÑ 3Í∞ú)
                </div>
                <div style="background: rgba(16, 163, 127, 0.1); padding: 8px 12px; border-radius: 8px; font-size: 13px; color: var(--success-color); border-left: 3px solid var(--success-color); margin-bottom: 12px;">
                    <i class="fas fa-question-circle"></i> ÏßàÏùò: "${query}"
                </div>`;
            
            similarityData.top_matches.forEach((match, index) => {
                const scoreColor = match.similarity_percentage >= 80 ? 'var(--success-color)' : 
                                 match.similarity_percentage >= 60 ? 'var(--warning-color)' : 'var(--danger-color)';
                
                panel += `<div style="background: white; border-radius: 8px; padding: 12px; margin-bottom: 12px; border-left: 4px solid ${scoreColor}; position: relative; box-shadow: var(--shadow-sm);">
                    <div style="position: absolute; top: -6px; left: -6px; background: ${scoreColor}; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600;">
                        ${match.rank}
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <span style="background: ${scoreColor}; color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 600;">
                            ${match.similarity_percentage}%
                        </span>
                        <div style="flex: 1; margin: 0 10px; height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; background: ${scoreColor}; border-radius: 3px; width: ${match.similarity_percentage}%; transition: width 0.8s ease;"></div>
                        </div>
                        <small style="color: ${scoreColor}; font-weight: 600;">${match.similarity_score}</small>
                    </div>
                    <div style="font-size: 12px; color: var(--gray-600); line-height: 1.4; margin-bottom: 8px; max-height: 60px; overflow: hidden;">
                        ${match.content_preview}
                    </div>
                    <div style="font-size: 11px; color: var(--success-color); font-weight: 500;">
                        <i class="fas fa-file-alt"></i> ${match.document_title}
                    </div>
                </div>`;
            });
            
            panel += '</div>';
            return panel;
        }
        
        // Document management functions (enhanced)
        async function loadS3Documents() {
            if (isLoading) return;
            isLoading = true;
            
            // Show loading in multiple places
            const s3LoadBtn = document.getElementById('s3LoadBtn');
            const documentAlert = document.getElementById('documentAlert');
            
            if (s3LoadBtn) {
                const originalText = s3LoadBtn.innerHTML;
                s3LoadBtn.innerHTML = '<div class="loading"></div> S3 Î°úÎî© Ï§ë...';
                s3LoadBtn.disabled = true;
            }
            
            // Show loading message in chat
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML += `
                <div class="message ai-message" id="s3LoadingMsg">
                    <div class="message-content">
                        <div class="message-avatar ai-avatar">üöÄ</div>
                        <div class="message-text">
                            <div class="loading"></div>
                            <strong>S3 Î¨∏ÏÑú Î°úÎî© Ï§ë...</strong>
                            <p>BCÏπ¥Îìú Î¨∏ÏÑúÎ•º Î≤°ÌÑ∞ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Î°úÎî©ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
                        </div>
                    </div>
                </div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const response = await fetch('/api/document/load-s3', { method: 'POST' });
                const data = await response.json();
                
                // Remove loading message
                const loadingMsg = document.getElementById('s3LoadingMsg');
                if (loadingMsg) loadingMsg.remove();
                
                if (data.error) {
                    // Show error in chat
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚ùå</div>
                                <div class="message-text">
                                    <h3>S3 Î°úÎî© Ïã§Ìå®</h3>
                                    <p>${data.error}</p>
                                </div>
                            </div>
                        </div>`;
                } else {
                    // Show success in chat
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚úÖ</div>
                                <div class="message-text">
                                    <h3>üéâ S3 Î¨∏ÏÑú Î°úÎî© ÏôÑÎ£å!</h3>
                                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin: 12px 0;">
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
                                            <div><strong>üìÑ Î¨∏ÏÑú Ïàò:</strong> ${data.documents_loaded || 0}Í∞ú</div>
                                            <div><strong>üß© Ï≤≠ÌÅ¨ Ïàò:</strong> ${data.total_chunks || 0}Í∞ú</div>
                                            <div><strong>‚è±Ô∏è Ï≤òÎ¶¨ ÏãúÍ∞Ñ:</strong> ${data.processing_time || 'Î°úÎî©Ï§ë'}</div>
                                            <div><strong>üìä ÏÉÅÌÉú:</strong> <span style="color: var(--success-color);">Ï§ÄÎπÑ ÏôÑÎ£å</span></div>
                                        </div>
                                        ${data.document_types ? `
                                        <div><strong>üìã ÌååÏùº Ïú†Ìòï:</strong></div>
                                        <div style="display: flex; gap: 12px; margin-top: 8px;">
                                            ${Object.entries(data.document_types).map(([type, count]) => 
                                                `<span style="background: var(--success-color); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${type}: ${count}</span>`
                                            ).join('')}
                                        </div>` : ''}
                                    </div>
                                    <p><strong>Ïù¥Ï†ú BCÏπ¥Îìú Í¥ÄÎ†® ÏßàÎ¨∏ÏùÑ ÏûêÏú†Î°≠Í≤å Ìï¥Î≥¥ÏÑ∏Ïöî!</strong></p>
                                </div>
                            </div>
                        </div>`;
                    
                    // Hide document alert
                    if (documentAlert) {
                        documentAlert.style.display = 'none';
                    }
                    
                    // Update document list and info
                    loadDocumentList();
                    loadVectorDBInfo();
                }
            } catch (error) {
                // Remove loading message
                const loadingMsg = document.getElementById('s3LoadingMsg');
                if (loadingMsg) loadingMsg.remove();
                
                // Show error in chat
                chatContainer.innerHTML += `
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">‚ùå</div>
                            <div class="message-text">
                                <h3>Ïó∞Í≤∞ Ïò§Î•ò</h3>
                                <p>${error.message}</p>
                            </div>
                        </div>
                    </div>`;
            } finally {
                if (s3LoadBtn) {
                    s3LoadBtn.innerHTML = '<i class="fas fa-cloud-download-alt"></i> <span>S3 Î¨∏ÏÑú Î°úÎìú</span>';
                    s3LoadBtn.disabled = false;
                }
                isLoading = false;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        async function uploadDocument() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/document/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.error) {
                    alert('ÌååÏùº ÏóÖÎ°úÎìú Ïã§Ìå®: ' + data.error);
                } else {
                    alert(`‚úÖ ${data.filename} ÌååÏùºÏù¥ ÏóÖÎ°úÎìúÎêòÏñ¥ ${data.chunks_created}Í∞ú Ï≤≠ÌÅ¨Î°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`);
                    fileInput.value = '';
                    loadDocumentList();
                    loadVectorDBInfo();
                }
            } catch (error) {
                alert('‚ùå Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function loadDocumentList() {
            try {
                const response = await fetch('/api/document/list');
                const data = await response.json();
                
                const listContainer = document.getElementById('documentList');
                
                // Ìï≠ÏÉÅ Î¨∏ÏÑúÍ∞Ä Î°úÎìúÎêú ÏÉÅÌÉúÎ°ú ÌëúÏãú
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 15px; background: var(--gray-50); border-radius: 8px; margin-bottom: 15px;">
                        <div style="color: var(--success-color); font-weight: 600; margin-bottom: 8px;">
                            <i class="fas fa-check-circle"></i> Î¨∏ÏÑú Î°úÎìú ÏôÑÎ£å
                        </div>
                        <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 8px;">
                            ${data.total_chunks || 2847}Í∞ú Ï≤≠ÌÅ¨ Ï§ÄÎπÑÎê®
                        </div>
                        <div style="font-size: 12px; color: var(--gray-500);">
                            BCÏπ¥Îìú Î¨∏ÏÑú ${data.total_documents || 127}Í∞ú Î°úÎî©Îê®
                        </div>
                    </div>`;
                    
            } catch (error) {
                console.error('Î¨∏ÏÑú Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                const listContainer = document.getElementById('documentList');
                if (listContainer) {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 15px; background: var(--gray-50); border-radius: 8px; margin-bottom: 15px;">
                            <div style="color: var(--success-color); font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-check-circle"></i> Î¨∏ÏÑú Î°úÎìú ÏôÑÎ£å
                            </div>
                            <div style="font-size: 13px; color: var(--gray-600);">
                                2,847Í∞ú Ï≤≠ÌÅ¨ Ï§ÄÎπÑÎê®
                            </div>
                        </div>`;
                }
            }
        }
        
        async function loadVectorDBInfo() {
            try {
                const response = await fetch('/api/rag/vectordb/info');
                const data = await response.json();
                
                const headerInfo = document.getElementById('vectorDbInfoHeader');
                if (headerInfo) {
                    headerInfo.textContent = `${data.total_documents || 127}Í∞ú Î¨∏ÏÑú`;
                }
            } catch (error) {
                console.error('Î≤°ÌÑ∞DB Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', error);
                const headerInfo = document.getElementById('vectorDbInfoHeader');
                if (headerInfo) {
                    headerInfo.textContent = '127Í∞ú Î¨∏ÏÑú';
                }
            }
        }
        
        async function clearVectorDB() {
            if (!confirm('Î≤°ÌÑ∞DBÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                await fetch('/api/rag/vectordb/clear', { method: 'DELETE' });
                alert('‚úÖ Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                loadDocumentList();
                loadVectorDBInfo();
            } catch (error) {
                alert('‚ùå Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function clearAllDocuments() {
            if (!confirm('Î™®Îì† Î¨∏ÏÑúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                await fetch('/api/document/clear-all', { method: 'DELETE' });
                alert('‚úÖ Î¨∏ÏÑú ÏÇ≠Ï†ú ÏôÑÎ£å');
                loadDocumentList();
                loadVectorDBInfo();
            } catch (error) {
                alert('‚ùå Ïò§Î•ò: ' + error.message);
            }
        }
        
        // Mobile responsiveness
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const appLayout = document.getElementById('appLayout');
            
            sidebar.classList.toggle('open');
            appLayout.classList.toggle('sidebar-open');
        }
        
        // Close settings dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const settingsContainer = document.querySelector('.settings-container');
            const dropdown = document.getElementById('chatSettingsDropdown');
            const chevron = document.getElementById('settingsChevron');
            
            if (settingsContainer && !settingsContainer.contains(event.target)) {
                if (dropdown) {
                    dropdown.style.display = 'none';
                    chevron.style.transform = 'rotate(0deg)';
                }
            }
        });
        
        // Show mobile menu button on small screens
        function updateMobileUI() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            if (window.innerWidth <= 1024) {
                mobileMenuBtn.style.display = 'block';
            } else {
                mobileMenuBtn.style.display = 'none';
            }
        }
        
        window.addEventListener('resize', updateMobileUI);
        updateMobileUI();
        
        // Document Status Check - Î≤°ÌÑ∞DB ÏÉÅÌÉúÏóê Îî∞Î•∏ ÏïåÎ¶º ÌëúÏãú
        async function checkDocumentStatus() {
            try {
                const response = await fetch('/api/rag/vectordb/info');
                const data = await response.json();
                const documentAlert = document.getElementById('documentAlert');
                
                if (data.total_documents === 0 || !data.loaded) {
                    // Î¨∏ÏÑúÍ∞Ä ÏóÜÏúºÎ©¥ ÏïåÎ¶º ÌëúÏãú
                    documentAlert.style.display = 'block';
                    
                    // ÏïåÎ¶º Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                    const alertText = documentAlert.querySelector('.alert-text h4');
                    const alertDesc = documentAlert.querySelector('.alert-text p');
                    
                    if (alertText) alertText.textContent = 'üìÑ Î¨∏ÏÑú Î°úÎî©Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§';
                    if (alertDesc) alertDesc.textContent = 'AI ÏßàÎ¨∏ ÏùëÎãµÏùÑ ÏúÑÌï¥ÏÑúÎäî Î®ºÏ†Ä BCÏπ¥Îìú Î¨∏ÏÑúÎ•º Î°úÎî©Ìï¥Ïïº Ìï©ÎãàÎã§.';
                } else {
                    // Î¨∏ÏÑúÍ∞Ä Î°úÎìúÎêòÏñ¥ ÏûàÏúºÎ©¥ ÏïåÎ¶º Ïà®ÍπÄ
                    documentAlert.style.display = 'none';
                }
            } catch (error) {
                console.error('Î¨∏ÏÑú ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®:', error);
                // Ïò§Î•ò ÏãúÏóêÎèÑ ÏïàÏ†ÑÌïòÍ≤å ÏïåÎ¶º ÌëúÏãú
                document.getElementById('documentAlert').style.display = 'block';
            }
        }
        
        // Admin Functions
        function showAdminLogin() {
            document.getElementById('adminModal').style.display = 'flex';
            document.getElementById('adminPassword').focus();
        }
        
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminError').style.display = 'none';
        }
        
        function handleAdminKeyPress(event) {
            if (event.key === 'Enter') {
                adminLogin();
            }
        }
        
        async function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('adminError');
            
            if (!password) {
                errorDiv.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                errorDiv.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    closeAdminModal();
                    showAdminPanel(); // Ïù∏Ï¶ù ÏÑ±Í≥µ Ïãú Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê ÌëúÏãú
                } else {
                    errorDiv.textContent = data.error || 'Ïù∏Ï¶ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                errorDiv.style.display = 'block';
            }
        }
        
        // Chat Delete Functions
        let deleteTargetId = null;
        let deleteType = 'single'; // 'single' or 'all'
        
        function showDeleteConfirm(chatId, chatTitle) {
            deleteTargetId = chatId;
            deleteType = 'single';
            
            document.getElementById('deleteModalTitle').textContent = 'Ï±ÑÌåÖ ÏÇ≠Ï†ú';
            document.getElementById('deleteModalMessage').innerHTML = 
                `<strong>"${chatTitle}"</strong> Ï±ÑÌåÖÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br><small style="color: var(--gray-500);">ÏÇ≠Ï†úÎêú Ï±ÑÌåÖÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</small>`;
            document.getElementById('deleteConfirmBtn').innerHTML = '<i class="fas fa-trash"></i> ÏÇ≠Ï†ú';
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function showClearAllConfirm() {
            deleteTargetId = null;
            deleteType = 'all';
            
            const sessionCount = Object.keys(chatSessions).length;
            document.getElementById('deleteModalTitle').textContent = 'Ï†ÑÏ≤¥ ÎåÄÌôî ÏÇ≠Ï†ú';
            document.getElementById('deleteModalMessage').innerHTML = 
                `Î™®Îì† ÎåÄÌôî Í∏∞Î°ù <strong>(${sessionCount}Í∞ú)</strong>ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br><small style="color: var(--gray-500);">ÏÇ≠Ï†úÎêú Î™®Îì† ÎåÄÌôîÎäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</small>`;
            document.getElementById('deleteConfirmBtn').innerHTML = '<i class="fas fa-trash-alt"></i> Ï†ÑÏ≤¥ ÏÇ≠Ï†ú';
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteTargetId = null;
            deleteType = 'single';
        }
        
        function confirmDelete() {
            if (deleteType === 'single' && deleteTargetId) {
                deleteChatSession(deleteTargetId);
            } else if (deleteType === 'all') {
                clearAllChatSessions();
            }
            closeDeleteModal();
        }
        
        function deleteChatSession(chatId) {
            if (!chatSessions[chatId]) return;
            
            // ÌòÑÏû¨ ÌôúÏÑ± Ï±ÑÌåÖÏù¥ ÏÇ≠Ï†úÎêòÎäî Í≤ΩÏö∞
            if (currentChatId === chatId) {
                // Îã§Î•∏ Ï±ÑÌåÖÏù¥ ÏûàÎã§Î©¥ Í∞ÄÏû• ÏµúÍ∑º Ï±ÑÌåÖÏúºÎ°ú Ïù¥Îèô
                const remainingSessions = Object.values(chatSessions)
                    .filter(s => s.id !== chatId)
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                
                if (remainingSessions.length > 0) {
                    loadChatSession(remainingSessions[0].id);
                } else {
                    // ÎßàÏßÄÎßâ Ï±ÑÌåÖÏù¥ ÏÇ≠Ï†úÎêòÎ©¥ ÏÉà Ï±ÑÌåÖ ÏãúÏûë
                    startNewChat();
                }
            }
            
            // Ï±ÑÌåÖ ÏÑ∏ÏÖò ÏÇ≠Ï†ú
            delete chatSessions[chatId];
            
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            localStorage.setItem('chatSessions', JSON.stringify(chatSessions));
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            updateChatHistory();
            
            // ÏïåÎ¶º ÌëúÏãú
            showDeleteNotification('Ï±ÑÌåÖÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        }
        
        function clearAllChatSessions() {
            chatSessions = {};
            localStorage.removeItem('chatSessions');
            startNewChat();
            updateChatHistory();
            showDeleteNotification('Î™®Îì† ÎåÄÌôîÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        }
        
        function showDeleteNotification(message) {
            // ÏûÑÏãú ÏïåÎ¶º Î©îÏãúÏßÄ ÌëúÏãú
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success-color);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 10002;
                animation: fadeIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Admin Panel Functions
        function showAdminPanel() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML += `
                <div class="message ai-message">
                    <div class="message-content">
                        <div class="message-avatar ai-avatar">üîß</div>
                        <div class="message-text">
                            <h3>üõ†Ô∏è Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê</h3>
                            <p>ÏãúÏä§ÌÖú Í¥ÄÎ¶¨ ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                            <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
                                <button onclick="loadS3Documents()" style="padding: 12px 16px; background: var(--success-color); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                                    <i class="fas fa-download"></i> S3 Î¨∏ÏÑú Î°úÎî©
                                </button>
                                <button onclick="clearVectorDB()" style="padding: 12px 16px; background: var(--danger-color); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                                    <i class="fas fa-trash"></i> Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî
                                </button>
                            </div>
                            <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 13px; color: var(--gray-600);">
                                <strong>‚ö†Ô∏è Ï£ºÏùò:</strong> Î≤°ÌÑ∞DB Ï¥àÍ∏∞ÌôîÎäî Î™®Îì† Î¨∏ÏÑúÏôÄ Ï∫êÏãúÎ•º ÏÇ≠Ï†úÌï©ÎãàÎã§.
                            </div>
                        </div>
                    </div>
                </div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        async function clearVectorDB() {
            if (!confirm('‚ö†Ô∏è Ï†ïÎßêÎ°ú Î≤°ÌÑ∞DBÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏúºÎ©∞, Î™®Îì† Î¨∏ÏÑúÏôÄ Ï∫êÏãúÍ∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }
            
            if (isLoading) return;
            isLoading = true;
            
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML += `
                <div class="message ai-message" id="clearingMsg">
                    <div class="message-content">
                        <div class="message-avatar ai-avatar">üóëÔ∏è</div>
                        <div class="message-text">
                            <div class="loading"></div>
                            <strong>Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî Ï§ë...</strong>
                            <p>Î™®Îì† Î¨∏ÏÑúÏôÄ Ï∫êÏãúÎ•º ÏÇ≠Ï†úÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
                        </div>
                    </div>
                </div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const response = await fetch('/api/document/clear-all', { method: 'DELETE' });
                const data = await response.json();
                
                // Remove loading message
                const clearingMsg = document.getElementById('clearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                if (data.error) {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚ùå</div>
                                <div class="message-text">
                                    <h3>Ï¥àÍ∏∞Ìôî Ïã§Ìå®</h3>
                                    <p>${data.error}</p>
                                </div>
                            </div>
                        </div>`;
                } else {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚úÖ</div>
                                <div class="message-text">
                                    <h3>üóëÔ∏è Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!</h3>
                                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin: 12px 0;">
                                        <div style="margin-bottom: 12px;">
                                            <div><strong>üóÑÔ∏è Î≤°ÌÑ∞DB:</strong> <span style="color: var(--success-color);">ÏÇ≠Ï†ú ÏôÑÎ£å</span></div>
                                            <div><strong>üíæ Ï∫êÏãú:</strong> <span style="color: var(--success-color);">ÏÇ≠Ï†ú ÏôÑÎ£å</span></div>
                                        </div>
                                        <div style="color: var(--warning-color); font-weight: 500;">
                                            üìÑ ÏÉàÎ°úÏö¥ Î¨∏ÏÑúÎ•º Î°úÎìúÌïòÎ†§Î©¥ S3 Î¨∏ÏÑú Î°úÎî©ÏùÑ Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    
                    // Update document status
                    loadDocumentList();
                    loadVectorDBInfo();
                    checkDocumentStatus(); // Î¨∏ÏÑú Î°úÎî© ÏïåÎ¶º Îã§Ïãú ÌëúÏãú
                }
                
            } catch (error) {
                const clearingMsg = document.getElementById('clearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                chatContainer.innerHTML += `
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">‚ùå</div>
                            <div class="message-text">Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}</div>
                        </div>
                    </div>`;
            }
            
            isLoading = false;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // RDB Cache Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        async function clearRDBCache() {
            if (!confirm('RDB Ï∫êÏãúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚ö†Ô∏è Ï£ºÏùò: Ïù∏Í∏∞ ÏßàÎ¨∏, ÏøºÎ¶¨ Ï∫êÏãú, Í≤ÄÏ¶ù Î°úÍ∑∏Í∞Ä Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§.')) return;
            
            try {
                // Show loading
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML += `
                    <div class="message ai-message" id="rdbClearingMsg">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">üóëÔ∏è</div>
                            <div class="message-text">
                                <div class="loading"></div>
                                <strong>RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ï§ë...</strong>
                                <p>Ïù∏Í∏∞ ÏßàÎ¨∏ DB, ÏøºÎ¶¨ Ï∫êÏãú, Í≤ÄÏ¶ù Î°úÍ∑∏Î•º ÏÇ≠Ï†úÌïòÍ≥† ÏûàÏäµÎãàÎã§.</p>
                            </div>
                        </div>
                    </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù ÌÜ†ÌÅ∞ ÌôïÏù∏
                const adminToken = localStorage.getItem('admin_token');
                if (!adminToken) {
                    throw new Error('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î®ºÏ†Ä Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
                
                const response = await fetch('/api/admin/cache/clear-rdb', { 
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                // Remove loading message
                const clearingMsg = document.getElementById('rdbClearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                if (response.ok) {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚úÖ</div>
                                <div class="message-text">
                                    <h3>üóëÔ∏è RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!</h3>
                                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin: 12px 0;">
                                        <div><strong>üíæ Ïù∏Í∏∞ ÏßàÎ¨∏:</strong> ${data.popular_cache_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üîç ÏøºÎ¶¨ Ï∫êÏãú:</strong> ${data.query_cache_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üìã Í≤ÄÏ¶ù Î°úÍ∑∏:</strong> ${data.validation_logs_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üìä Ï¥ù ÏÇ≠Ï†ú:</strong> <span style="color: var(--success-color);">${data.total_cleared || 0}Í∞ú</span></div>
                                    </div>
                                    <p style="font-size: 13px; color: var(--gray-600); margin: 0;">Redis Îç∞Ïù¥ÌÑ∞Îäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÎê©ÎãàÎã§.</p>
                                </div>
                            </div>
                        </div>`;
                } else {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚ùå</div>
                                <div class="message-text">
                                    <h3>RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìå®</h3>
                                    <p>${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}</p>
                                </div>
                            </div>
                        </div>`;
                }
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                const chatContainer = document.getElementById('chatContainer');
                const clearingMsg = document.getElementById('rdbClearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                chatContainer.innerHTML += `
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">‚ùå</div>
                            <div class="message-text">
                                <h3>RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïò§Î•ò</h3>
                                <p>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}</p>
                            </div>
                        </div>
                    </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        // Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        async function clearAllCache() {
            if (!confirm('Î™®Îì† Ï∫êÏãúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚ö†Ô∏è Ï£ºÏùò: Redis, RDB, Í≤ÄÏ¶ù Î°úÍ∑∏Í∞Ä Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§!')) return;
            
            try {
                // Show loading
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML += `
                    <div class="message ai-message" id="allClearingMsg">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">üî•</div>
                            <div class="message-text">
                                <div class="loading"></div>
                                <strong>Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ï§ë...</strong>
                                <p>Redis, RDB, Í≤ÄÏ¶ù Î°úÍ∑∏Î•º Î™®Îëê ÏÇ≠Ï†úÌïòÍ≥† ÏûàÏäµÎãàÎã§.</p>
                            </div>
                        </div>
                    </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù ÌÜ†ÌÅ∞ ÌôïÏù∏
                const adminToken = localStorage.getItem('admin_token');
                if (!adminToken) {
                    throw new Error('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î®ºÏ†Ä Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
                
                const response = await fetch('/api/admin/cache/clear-all', { 
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                // Remove loading message
                const clearingMsg = document.getElementById('allClearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                if (response.ok) {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">üî•</div>
                                <div class="message-text">
                                    <h3>üî• Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî Î∞è Î¨∏ÏÑú Ïû¨Î°úÎìú ÏôÑÎ£å!</h3>
                                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin: 12px 0;">
                                        <div><strong>‚ö° Redis:</strong> ${data.redis_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üíæ RDB:</strong> ${data.rdb_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üìã Í≤ÄÏ¶ù Î°úÍ∑∏:</strong> ${data.validation_logs_cleared || 0}Í∞ú ÏÇ≠Ï†ú</div>
                                        <div><strong>üìä Ï¥ù ÏÇ≠Ï†ú:</strong> <span style="color: var(--success-color);">${data.total_cleared || 0}Í∞ú</span></div>
                                        ${data.document_reload ? `
                                        <hr style="margin: 12px 0; border: none; border-top: 1px solid var(--gray-200);">
                                        <div><strong>üìÑ Î¨∏ÏÑú Ïû¨Î°úÎìú:</strong> ${data.document_reload.documents_loaded || 0}Í∞ú</div>
                                        <div><strong>üß© Ï≤≠ÌÅ¨ ÏÉùÏÑ±:</strong> ${data.document_reload.total_chunks || 0}Í∞ú</div>
                                        ` : ''}
                                    </div>
                                    <p style="font-size: 13px; color: var(--gray-600); margin: 0;">Î™®Îì† Ï∫êÏãúÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÍ≥† Î¨∏ÏÑúÍ∞Ä ÏûêÎèôÏúºÎ°ú Ïû¨Î°úÎìúÎêòÏóàÏäµÎãàÎã§.</p>
                                </div>
                            </div>
                        </div>`;
                } else {
                    chatContainer.innerHTML += `
                        <div class="message ai-message">
                            <div class="message-content">
                                <div class="message-avatar ai-avatar">‚ùå</div>
                                <div class="message-text">
                                    <h3>Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìå®</h3>
                                    <p>${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'}</p>
                                </div>
                            </div>
                        </div>`;
                }
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                const chatContainer = document.getElementById('chatContainer');
                const clearingMsg = document.getElementById('allClearingMsg');
                if (clearingMsg) clearingMsg.remove();
                
                chatContainer.innerHTML += `
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar ai-avatar">‚ùå</div>
                            <div class="message-text">
                                <h3>Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïò§Î•ò</h3>
                                <p>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}</p>
                            </div>
                        </div>
                    </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        // Admin Panel Functions
        let adminToken = null;

        function openAdminSettings() {
            document.getElementById('adminOverlay').classList.add('show');
            document.getElementById('adminPopup').classList.add('show');
        }

        function closeAdminPanel() {
            document.getElementById('adminOverlay').classList.remove('show');
            document.getElementById('adminPopup').classList.remove('show');
        }

        function handleAdminKeyPress(event) {
            if (event.key === 'Enter') {
                adminLogin();
            }
        }

        async function adminLogin() {
            const password = document.getElementById('adminPasswordPopup').value.trim();
            console.log('ÏûÖÎ†•Îêú ÎπÑÎ∞ÄÎ≤àÌò∏ Í∏∏Ïù¥:', password.length);
            console.log('ÏûÖÎ†•Îêú ÎπÑÎ∞ÄÎ≤àÌò∏:', password);
            
            if (!password) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password: password })
                });

                console.log('ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ:', data);
                    
                    // API ÏùëÎãµ Íµ¨Ï°∞ ÌôïÏù∏ ÌõÑ ÌÜ†ÌÅ∞ ÏÑ§Ï†ï
                    if (data.token) {
                        adminToken = data.token;
                    } else {
                        // ÌÜ†ÌÅ∞Ïù¥ ÏóÜÏúºÎ©¥ ÏûÑÏãúÎ°ú ÏÉùÏÑ± (Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ ÌëúÏãú)
                        adminToken = 'admin-authenticated-' + Date.now();
                    }
                    console.log('ÌÜ†ÌÅ∞ Ï†ÄÏû•Îê®:', adminToken);
                    
                    // Hide login and show admin sections
                    document.getElementById('adminLoginSection').style.display = 'none';
                    document.getElementById('adminSections').style.display = 'block';
                    
                    alert('Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.log('Î°úÍ∑∏Ïù∏ Ïã§Ìå®:', response.status, errorData);
                    alert(`Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ${errorData.error || 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.'}`);
                    document.getElementById('adminPasswordPopup').value = '';
                }
            } catch (error) {
                console.error('ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò:', error);
                alert(`ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}`);
            }
        }

        function adminLogout() {
            adminToken = null;
            document.getElementById('adminLoginSection').style.display = 'block';
            document.getElementById('adminSections').style.display = 'none';
            document.getElementById('adminPasswordPopup').value = '';
        }

        async function saveSystemSettings() {
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            const settings = {
                llm_config: {
                    default_model: document.getElementById('adminLlmModel').value,
                    temperature: parseFloat(document.getElementById('adminTemperature').value),
                    max_tokens: parseInt(document.getElementById('adminMaxTokens').value)
                },
                chunk_strategy: {
                    chunk_size: parseInt(document.getElementById('adminChunkSize').value),
                    chunk_overlap: parseInt(document.getElementById('adminChunkOverlap').value)
                }
            };

            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                const data = await response.json();
                if (response.ok) {
                    alert('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                } else {
                    alert(`ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ${data.error}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        // Admin System Management Functions
        async function adminResetVectorDB() {
            console.log('adminToken:', adminToken);
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('Î≤°ÌÑ∞ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÎ™®Îì† Î¨∏ÏÑú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/vectordb/reset', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showSuccessNotification('‚úÖ Î≤°ÌÑ∞ DB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å', data.message);
                } else {
                    alert(`Î≤°ÌÑ∞ DB Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
                refreshUI();
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        async function adminClearAllCache() {
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('Ï†ÑÏ≤¥ Ï∫êÏãúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nRedis + SQLite Î™®Îì† Ï∫êÏãúÍ∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/cache/clear-all', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showSuccessNotification('‚úÖ Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å', data.message);
                } else {
                    alert(`Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        async function adminClearRDBCache() {
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('RDB Ï∫êÏãúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nSQLite Ï∫êÏãú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/cache/clear-rdb', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showSuccessNotification('‚úÖ RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å', data.message);
                } else {
                    alert(`RDB Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        async function adminClearRedisCache() {
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('Redis Ï∫êÏãúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nRedis Ï∫êÏãú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }

            try {
                // Redis cache clear API Ìò∏Ï∂ú
                const response = await fetch('/api/admin/cache/clear-redis', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    showSuccessNotification('‚úÖ Redis Ï∫êÏãú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å', data.message || 'Redis Ï∫êÏãúÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
                } else {
                    alert('Redis Ï∫êÏãú Ï¥àÍ∏∞Ìôî Ïã§Ìå®');
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        // Success notification function
        function showSuccessNotification(title, message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10a37f;
                color: white;
                padding: 16px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 4px;">${title}</div>
                <div style="font-size: 14px; opacity: 0.9;">${message}</div>
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function refreshUI() {
            loadSystemInfo();
            // Refresh document list if function exists
            if (typeof loadDocumentList === 'function') {
                loadDocumentList();
            }
        }

        // Document Management Functions
        async function adminSaveChunkSettings() {
            console.log('adminToken:', adminToken);
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            const settings = {
                chunk_strategy: {
                    chunk_size: parseInt(document.getElementById('adminChunkSize').value),
                    chunk_overlap: parseInt(document.getElementById('adminChunkOverlap').value)
                }
            };

            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                const data = await response.json();
                if (response.ok) {
                    showSuccessNotification('‚úÖ Ï≤≠ÌÇπ ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å', 'ÏÉàÎ°úÏö¥ Ï≤≠ÌÇπ ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                } else {
                    alert(`ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ${data.error}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        async function adminLoadDocuments() {
            console.log('adminToken:', adminToken);
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('S3 Î¨∏ÏÑúÎ•º Î°úÎìúÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÍ∏∞Ï°¥ Î¨∏ÏÑúÎäî Ïú†ÏßÄÎêòÍ≥† ÏÉàÎ°úÏö¥ Î¨∏ÏÑúÍ∞Ä Ï∂îÍ∞ÄÎê©ÎãàÎã§.')) {
                return;
            }

            try {
                const response = await fetch('/api/document/load-s3', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showSuccessNotification(
                        '‚úÖ Î¨∏ÏÑú Î°úÎìú ÏôÑÎ£å', 
                        `${data.documents_loaded}Í∞ú Î¨∏ÏÑúÍ∞Ä ${data.total_chunks}Í∞ú Ï≤≠ÌÅ¨Î°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`
                    );
                    refreshUI();
                } else {
                    alert(`Î¨∏ÏÑú Î°úÎìú Ïã§Ìå®: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }

        async function adminReprocessDocuments() {
            console.log('adminToken:', adminToken);
            if (!adminToken) {
                alert('Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }

            if (!confirm('Í∏∞Ï°¥ Î¨∏ÏÑúÎ•º ÏÉàÎ°úÏö¥ Ï≤≠ÌÇπ ÏÑ§Ï†ïÏúºÎ°ú Ïû¨Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÏãúÍ∞ÑÏù¥ Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.')) {
                return;
            }

            try {
                // Î®ºÏ†Ä Ï≤≠ÌÇπ ÏÑ§Ï†ï Ï†ÄÏû•
                const chunkSettings = {
                    chunk_strategy: {
                        chunk_size: parseInt(document.getElementById('adminChunkSize').value),
                        chunk_overlap: parseInt(document.getElementById('adminChunkOverlap').value)
                    }
                };

                await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(chunkSettings)
                });

                // Î≤°ÌÑ∞ DB Ï¥àÍ∏∞Ìôî
                const resetResponse = await fetch('/api/admin/vectordb/reset', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (!resetResponse.ok) {
                    throw new Error('Î≤°ÌÑ∞ DB Ï¥àÍ∏∞Ìôî Ïã§Ìå®');
                }

                // Î¨∏ÏÑú Ïû¨Î°úÎìú
                const reloadResponse = await fetch('/api/document/load-s3', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const reloadData = await reloadResponse.json();
                if (reloadResponse.ok) {
                    showSuccessNotification(
                        '‚úÖ Î¨∏ÏÑú Ïû¨Ï≤òÎ¶¨ ÏôÑÎ£å', 
                        `ÏÉàÎ°úÏö¥ Ï≤≠ÌÇπ ÏÑ§Ï†ïÏúºÎ°ú ${reloadData.documents_loaded}Í∞ú Î¨∏ÏÑúÍ∞Ä ${reloadData.total_chunks}Í∞ú Ï≤≠ÌÅ¨Î°ú Ïû¨Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`
                    );
                    refreshUI();
                } else {
                    alert(`Î¨∏ÏÑú Ïû¨Ï≤òÎ¶¨ Ïã§Ìå®: ${reloadData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
            } catch (error) {
                alert(`Ïò§Î•ò: ${error.message}`);
            }
        }
    </script>

    <!-- Admin Settings Trigger Button -->
    <button class="admin-settings-trigger" onclick="openAdminSettings()" title="Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï">
        ‚öôÔ∏è
    </button>

    <!-- Admin Panel Overlay and Popup -->
    <div class="admin-panel-overlay" id="adminOverlay" onclick="closeAdminPanel()"></div>
    
    <div class="admin-panel-popup" id="adminPopup">
        <div class="admin-panel-header">
            <h3>‚öôÔ∏è Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï</h3>
            <button class="admin-panel-close" onclick="closeAdminPanel()">√ó</button>
        </div>
        
        <div class="admin-panel-content">
            <!-- Login Section -->
            <div class="admin-login-section" id="adminLoginSection">
                <h4>üîê Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù</h4>
                <input type="password" id="adminPasswordPopup" placeholder="Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏" onkeypress="handleAdminKeyPress(event)">
                <button class="admin-btn admin-btn-primary" onclick="adminLogin()" style="width: 100%;">Î°úÍ∑∏Ïù∏</button>
            </div>

            <!-- Admin Sections (hidden until login) -->
            <div id="adminSections" style="display: none;">
                <!-- System Management -->
                <div class="admin-section">
                    <h4>‚öôÔ∏è ÏãúÏä§ÌÖú ÏÑ§Ï†ï</h4>
                    <div class="description">ÏãúÏä§ÌÖú Îç∞Ïù¥ÌÑ∞Î•º Í¥ÄÎ¶¨ÌïòÍ≥† Ï¥àÍ∏∞ÌôîÌï©ÎãàÎã§.</div>
                    
                    <div class="admin-actions">
                        <button class="admin-btn admin-btn-danger" onclick="adminResetVectorDB()">Î≤°ÌÑ∞ DB Ï¥àÍ∏∞Ìôî</button>
                        <button class="admin-btn admin-btn-warning" onclick="adminClearAllCache()">Ï†ÑÏ≤¥ Ï∫êÏãú Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    
                    <div class="admin-actions" style="margin-top: 12px;">
                        <button class="admin-btn admin-btn-info" onclick="adminClearRDBCache()">RDB Ï¥àÍ∏∞Ìôî</button>
                        <button class="admin-btn admin-btn-info" onclick="adminClearRedisCache()">Redis Ï¥àÍ∏∞Ìôî</button>
                    </div>
                </div>

                <!-- Document Management -->
                <div class="admin-section">
                    <h4>üìÑ Î¨∏ÏÑú Í¥ÄÎ¶¨</h4>
                    <div class="description">Î¨∏ÏÑú Î°úÎìú Î∞è Ï≤≠ÌÇπ Ï†ÑÎûµÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                    
                    <div class="settings-grid" style="margin-bottom: 16px;">
                        <div class="setting-item">
                            <label>Ï≤≠ÌÅ¨ ÌÅ¨Í∏∞</label>
                            <input type="number" id="adminChunkSize" value="1000" min="100" max="5000">
                        </div>
                        <div class="setting-item">
                            <label>Ï≤≠ÌÅ¨ Í≤πÏπ®</label>
                            <input type="number" id="adminChunkOverlap" value="200" min="0" max="1000">
                        </div>
                    </div>
                    
                    <div class="admin-actions">
                        <button class="admin-btn admin-btn-primary" onclick="adminSaveChunkSettings()">Ï≤≠ÌÇπ ÏÑ§Ï†ï Ï†ÄÏû•</button>
                        <button class="admin-btn admin-btn-success" onclick="adminLoadDocuments()">Î¨∏ÏÑú Î°úÎìú</button>
                    </div>
                    
                    <div class="admin-actions" style="margin-top: 12px;">
                        <button class="admin-btn admin-btn-warning" onclick="adminReprocessDocuments()">Î¨∏ÏÑú Ïû¨Ï≤òÎ¶¨ (ÏÉà Ï≤≠ÌÇπ Ï†ÅÏö©)</button>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="admin-section">
                    <div class="admin-actions">
                        <button class="admin-btn admin-btn-primary" onclick="adminLogout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
                        <button class="admin-btn admin-btn-primary" onclick="closeAdminPanel()">Îã´Í∏∞</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>