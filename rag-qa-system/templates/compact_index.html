<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ RAG QA System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-title {
            color: white;
            text-align: center;
            margin: 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .content-grid {
            display: flex;
            height: calc(100vh - 120px);
            gap: 0;
            position: relative;
        }
        
        .left-panel {
            width: 320px;
            min-width: 320px;
            background: #f7f7f8;
            border-right: 1px solid #e5e5e7;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            left: 0;
            top: 120px;
            height: calc(100vh - 120px);
            z-index: 100;
        }
        
        .left-panel-header {
            padding: 20px 16px 16px;
            border-bottom: 1px solid #e5e5e7;
            background: white;
        }
        
        .left-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .right-panel {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
            position: relative;
            margin-left: 320px;
        }
        
        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid #e5e5e7;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .chat-settings {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .section-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 8px;
            width: 16px;
        }
        
        .chat-container {
            flex: 1;
            background: white;
            overflow-y: auto;
            padding: 24px;
            scroll-behavior: smooth;
        }
        
        .chat-input-area {
            padding: 16px 24px;
            border-top: 1px solid #e5e5e7;
            background: white;
        }
        
        .chat-input-container {
            max-width: 768px;
            margin: 0 auto;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            min-height: 52px;
            max-height: 200px;
            padding: 14px 50px 14px 16px;
            border: 1px solid #d1d5db;
            border-radius: 26px;
            resize: none;
            font-size: 16px;
            line-height: 1.5;
            outline: none;
            transition: all 0.2s;
        }
        
        .chat-input:focus {
            border-color: #10a37f;
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }
        
        .send-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 18px;
            background: #10a37f;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .send-button:hover {
            background: #0d8c6b;
        }
        
        .send-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }
        
        .message {
            margin-bottom: 32px;
            width: 100%;
        }
        
        .message-content {
            max-width: 768px;
            margin: 0 auto;
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .user-avatar {
            background: #10a37f;
            color: white;
        }
        
        .ai-avatar {
            background: #f7f7f8;
            color: #374151;
            border: 1px solid #e5e5e7;
        }
        
        .message-text {
            flex: 1;
            padding: 0;
            line-height: 1.75;
            color: #374151;
        }
        
        .user-message .message-text {
            color: white;
            background: #10a37f;
            padding: 12px 16px;
            border-radius: 18px;
            margin-left: auto;
            max-width: fit-content;
        }
        
        .ai-message .message-text {
            color: #374151;
            background: transparent;
        }
        
        .ai-message h3 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 12px;
        }
        
        .ai-message table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 13px;
        }
        
        .ai-message table th,
        .ai-message table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        
        .ai-message table th {
            background: #e7f3ff;
            font-weight: 600;
        }
        
        .ai-message strong {
            color: #0066cc;
        }
        
        .ai-message ul {
            padding-left: 20px;
        }
        
        .ai-message .list-check {
            list-style: none;
            padding-left: 0;
        }
        
        .ai-message .list-check li {
            padding-left: 25px;
            position: relative;
            margin-bottom: 5px;
        }
        
        .source-doc {
            font-size: 11px;
            color: #6c757d;
            background: #f1f3f5;
            padding: 8px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border-top: 1px solid #e9ecef;
        }
        
        .compact-form-group {
            margin-bottom: 10px;
        }
        
        .compact-form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .btn-compact {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }
        
        .btn-action {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40,167,69,0.4);
        }
        
        .btn-secondary-action {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            border: none;
            color: white;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            background: #e7f3ff;
            color: #0066cc;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px;
        }
        
        .model-selector {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            border-radius: 8px;
        }
        
        .model-selector option {
            background: white;
            color: #495057;
        }
        
        /* Enhanced checkbox styling */
        .form-check-input {
            width: 1.2em;
            height: 1.2em;
            margin-top: 0.1em;
            background-color: #fff;
            border: 2px solid #007bff;
            border-radius: 0.25em;
            transition: all 0.15s ease-in-out;
        }
        
        .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .form-check-input:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        .form-check-label {
            font-size: 13px;
            font-weight: 500;
            color: #495057;
            margin-left: 0.5rem;
            cursor: pointer;
        }
        
        /* FAQ buttons styling */
        .faq-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        .btn-faq {
            font-size: 11px;
            padding: 6px 8px;
            text-align: left;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .btn-faq:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }
        
        /* Error message styling */
        .error-message {
            background: #fff5f5 !important;
            border-left: 4px solid #e53e3e !important;
            border-radius: 12px !important;
        }
        
        .error-message h3 {
            color: #c53030 !important;
            margin-bottom: 10px;
        }
        
        .error-code {
            background: #fed7d7;
            color: #c53030;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .error-solution {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .error-solution strong {
            color: #2f855a;
        }
        
        /* Success message styling */
        .success-message {
            background: #f0fff4 !important;
            border-left: 4px solid #38a169 !important;
            border-radius: 12px !important;
        }
        
        .success-message h3 {
            color: #2f855a !important;
            margin-bottom: 10px;
        }
        
        .progress-thin {
            height: 3px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .document-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 12px;
        }
        
        .document-item {
            padding: 6px 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Document status styling */
        .document-status {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .document-status.empty {
            background: #fff5f5;
            border: 1px solid #fed7d7;
        }
        
        .document-status.loaded {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
        }
        
        .status-icon {
            font-size: 16px;
            margin-right: 10px;
        }
        
        .status-text strong {
            font-size: 12px;
            display: block;
        }
        
        .status-text small {
            font-size: 10px;
            color: #666;
        }
        
        .document-section {
            margin-bottom: 10px;
        }
        
        .section-header {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            padding-bottom: 3px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .s3-file {
            border-left: 3px solid #17a2b8;
        }
        
        .s3-badge {
            background: #17a2b8;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
        }
        
        .api-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #fd7e14, #e8590c);
            color: white;
            padding: 12px 16px;
            border-radius: 25px;
            text-decoration: none;
            box-shadow: 0 4px 20px rgba(253,126,20,0.4);
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .api-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(253,126,20,0.6);
            color: white;
        }
        
        @media (max-width: 1200px) {
            .left-panel {
                position: relative !important;
                width: 100%;
                height: auto;
                top: auto;
                left: auto;
                border-right: none;
                border-bottom: 1px solid #e5e5e7;
            }
            
            .right-panel {
                margin-left: 0;
            }
            
            .content-grid {
                flex-direction: column;
                height: auto;
            }
            
            .chat-container {
                height: 50vh;
            }
            
            .faq-buttons {
                flex-wrap: wrap;
                gap: 4px;
            }
            
            .faq-button {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .settings-dropdown {
                right: 0;
                left: auto;
                min-width: 250px;
            }
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #28a745;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        .loading-message {
            background: #e3f2fd !important;
            border-left: 4px solid #2196f3 !important;
            border-radius: 12px !important;
        }
        
        .loading-message h3 {
            color: #1976d2 !important;
            display: flex;
            align-items: center;
        }
        
        .loading-progress {
            margin-top: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            height: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #2196f3, #21cbf3, #2196f3);
            height: 100%;
            width: 0%;
            animation: progressLoad 2s ease-in-out infinite;
            background-size: 200% 100%;
        }
        
        .completion-animation {
            font-size: 24px;
            display: inline-block;
            animation: bounce 0.6s ease-in-out;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes progressLoad {
            0% { width: 0%; background-position: 0% 50%; }
            50% { width: 70%; background-position: 100% 50%; }
            100% { width: 100%; background-position: 0% 50%; }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        /* Similarity Score Display */
        .similarity-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            border: 2px solid #e9ecef;
        }
        
        .similarity-header {
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .similarity-header i {
            margin-right: 8px;
            color: #007bff;
        }
        
        .similarity-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
            position: relative;
        }
        
        .similarity-rank {
            position: absolute;
            top: -5px;
            left: -5px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }
        
        .similarity-score {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .score-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .score-bar {
            flex: 1;
            margin: 0 10px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .score-progress {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 3px;
            transition: width 0.8s ease;
        }
        
        .similarity-preview {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.4;
            margin-bottom: 8px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .similarity-source {
            font-size: 11px;
            color: #007bff;
            font-weight: 500;
        }
        
        .similarity-meta {
            display: flex;
            justify-content: between;
            align-items: center;
            font-size: 10px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .query-highlight {
            background: rgba(0, 123, 255, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #007bff;
            border-left: 3px solid #007bff;
            margin-bottom: 10px;
        }
        
        .similarity-collapse {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .similarity-collapse.expanded {
            max-height: 500px;
        }
        
        .similarity-toggle {
            background: transparent;
            border: none;
            color: #007bff;
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Cache indicator */
        .cache-indicator {
            display: inline-block;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
            animation: fadeIn 0.3s ease;
        }
        
        .cache-indicator i {
            margin-right: 4px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* FAQ Buttons */
        .faq-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0;
        }
        
        .faq-button {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 16px;
            padding: 8px 14px;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .faq-button:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        
        /* Chat Header Styles */
        .chat-title h3 {
            margin: 0;
            color: #374151;
            font-size: 18px;
            font-weight: 600;
        }
        
        .chat-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* Settings Toggle */
        .settings-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            font-size: 14px;
            color: #374151;
        }
        
        .settings-toggle:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .settings-toggle i:last-child {
            transition: transform 0.2s;
        }
        
        .settings-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 12px;
            min-width: 280px;
            z-index: 1000;
            display: none;
            animation: fadeInDown 0.2s ease;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-size: 14px;
            color: #374151;
        }
        
        .setting-control {
            font-size: 14px;
        }
        
        .setting-control select {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 4px 8px;
        }
        
        /* Admin Settings Button */
        .admin-settings-btn {
            position: fixed;
            bottom: 20px;
            right: 100px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102,126,234,0.4);
            transition: all 0.3s ease;
            font-size: 20px;
        }
        
        .admin-settings-btn:hover {
            transform: translateY(-3px) rotate(90deg);
            box-shadow: 0 6px 25px rgba(102,126,234,0.6);
        }
        
        /* Admin Modal */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .admin-modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .admin-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }
        
        .admin-close:hover {
            color: #000;
        }
        
        .admin-form {
            text-align: center;
            padding: 20px;
        }
        
        .admin-form input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .admin-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .admin-btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .admin-tab {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .admin-tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .admin-tab:hover {
            color: #667eea;
        }
        
        .admin-tab-content {
            display: none;
            padding: 20px 0;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .admin-setting-group {
            margin-bottom: 20px;
        }
        
        .admin-setting-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        .admin-setting-group input,
        .admin-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .admin-select {
            cursor: pointer;
        }
        
        .cache-status {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .admin-actions {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
        }
        
        .admin-save {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .admin-logout {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        #redisTestResult {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .test-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .cache-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .cache-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .admin-actions-inline {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .cache-stats-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stats-card {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .stats-card h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #495057;
        }
        
        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        /* New Chat Button */
        .new-chat-section {
            padding: 16px;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .btn-new-chat {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #10a37f, #0d8c6b);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-new-chat:hover {
            background: linear-gradient(135deg, #0d8c6b, #0a7c5a);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }
        
        /* Chat History Styles */
        .chat-history-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-history-list {
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .chat-history-item {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .chat-history-item:hover {
            background: #f3f4f6;
            border-left-color: #10a37f;
        }
        
        .chat-history-item.active {
            background: #e8f5f2;
            border-left-color: #10a37f;
            font-weight: 500;
        }
        
        .chat-history-title {
            color: #374151;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .chat-history-time {
            color: #9ca3af;
            font-size: 11px;
        }
        
        .chat-history-preview {
            color: #6b7280;
            font-size: 11px;
            margin-top: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: 8px;
        }
        
        .collapsible-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
            user-select: none;
        }
        
        .collapsible-header:hover {
            background: #f3f4f6;
            margin: -4px;
            padding: 4px;
            border-radius: 6px;
        }
        
        .toggle-icon {
            font-size: 12px;
            transition: transform 0.3s;
            color: #9ca3af;
        }
        
        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
        }
        
        /* Empty State for Chat History */
        .chat-history-empty {
            text-align: center;
            padding: 20px 16px;
            color: #9ca3af;
            font-size: 13px;
        }
        
        .chat-history-empty i {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
            color: #d1d5db;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-section">
            <h1 class="header-title">ü§ñ RAG QA System - Compact Edition</h1>
        </div>
        
        <div class="content-grid">
            <!-- Left Panel - Chat History & Controls -->
            <div class="left-panel">
                <!-- New Chat Button -->
                <div class="new-chat-section">
                    <button class="btn-new-chat" onclick="startNewChat()">
                        <i class="fas fa-plus"></i> ÏÉà Ï±ÑÌåÖ
                    </button>
                </div>
                
                <!-- Chat History -->
                <div class="section-card chat-history-section">
                    <div class="section-title">
                        <i class="fas fa-history"></i>Ï±ÑÌåÖ Í∏∞Î°ù
                    </div>
                    <div class="chat-history-list" id="chatHistoryList">
                        <!-- Chat sessions will be loaded here -->
                    </div>
                </div>
                
                <!-- System Settings (Collapsible) -->
                <div class="section-card collapsible-section">
                    <div class="section-title collapsible-header" onclick="toggleSection('systemSettings')">
                        <i class="fas fa-cog"></i>ÏãúÏä§ÌÖú ÏÑ§Ï†ï
                        <i class="fas fa-chevron-down toggle-icon" id="systemSettingsIcon"></i>
                    </div>
                    <div class="collapsible-content" id="systemSettings">
                        <div class="compact-form-group">
                            <label>LLM Î™®Îç∏:</label>
                            <select class="form-select form-select-sm model-selector" id="llmModel">
                                <option value="gpt-4o-mini">GPT-4o-mini (Îπ†Î¶Ñ)</option>
                                <option value="gpt-4-turbo">GPT-4.1-mini (Ï†ïÌôï)</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-6 compact-form-group">
                                <label>Ï≤≠ÌÅ¨:</label>
                                <input type="number" class="form-control form-control-sm" id="chunkSize" value="1000">
                            </div>
                            <div class="col-6 compact-form-group">
                                <label>Í≤πÏπ®:</label>
                                <input type="number" class="form-control form-control-sm" id="chunkOverlap" value="200">
                            </div>
                        </div>
                        <div class="status-badge" id="vectorDbInfo">Î°úÎî©Ï§ë...</div>
                        <button class="btn btn-outline-danger btn-compact btn-sm float-end mt-2" onclick="clearVectorDB()">
                            <i class="fas fa-trash"></i> Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                </div>
                
                <!-- Document Management (Collapsible) -->
                <div class="section-card collapsible-section">
                    <div class="section-title collapsible-header" onclick="toggleSection('documentManagement')">
                        <i class="fas fa-folder"></i>Î¨∏ÏÑú Í¥ÄÎ¶¨
                        <i class="fas fa-chevron-down toggle-icon" id="documentManagementIcon"></i>
                    </div>
                    <div class="collapsible-content collapsed" id="documentManagement">
                        <button class="btn btn-action btn-compact w-100 mb-2" id="s3LoadBtn" onclick="loadS3Documents()">
                            <i class="fas fa-download"></i> S3 Ìè¥Îçî Î°úÎìú
                        </button>
                        
                        <div class="input-group input-group-sm mb-2">
                            <input type="file" class="form-control form-control-sm" id="fileInput" accept=".pdf,.txt,.docx,.md">
                            <button class="btn btn-action btn-compact" id="uploadBtn" onclick="uploadDocument()">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                        
                        <div class="input-group input-group-sm mb-2">
                            <input type="text" class="form-control form-control-sm" id="textTitle" placeholder="Ï†úÎ™©">
                            <button class="btn btn-action btn-compact" onclick="toggleTextInput()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div id="textInputSection" style="display:none;" class="mb-2">
                            <textarea class="form-control form-control-sm" id="textInput" rows="3" placeholder="ÌÖçÏä§Ìä∏ ÏûÖÎ†•..."></textarea>
                            <button class="btn btn-secondary-action btn-compact mt-1" onclick="uploadText()">Ï∂îÍ∞Ä</button>
                        </div>
                        
                        <div class="document-list" id="documentList">
                            <!-- Documents will be loaded here -->
                        </div>
                        
                        <button class="btn btn-outline-danger btn-compact btn-sm w-100 mt-2" onclick="clearAllDocuments()">
                            <i class="fas fa-trash"></i> Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Chat -->
            <div class="right-panel">
                <!-- Chat Header with FAQ and Settings -->
                <div class="chat-header">
                    <div class="chat-title">
                        <h3 style="margin: 0; color: #374151; font-size: 18px;">
                            <i class="fas fa-robot"></i> RAG QA System
                        </h3>
                    </div>
                    <div class="chat-controls">
                        <!-- Quick FAQ Buttons -->
                        <div class="faq-buttons">
                            <button class="faq-button" onclick="askQuestion('Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂úÏù¥ÎûÄ?')">üí≥ Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú</button>
                            <button class="faq-button" onclick="askQuestion('Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú Ïù¥Ïö©Î∞©Î≤ï')">üí∞ Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú</button>
                            <button class="faq-button" onclick="askQuestion('Ïπ¥Îìú Ìï†Î∂Ä ÏàòÏàòÎ£å')">üìä Ìï†Î∂Ä ÏàòÏàòÎ£å</button>
                            <button class="faq-button" onclick="askQuestion('Ïã†Ïö©Í≥µÏó¨Í∏∞Í∞ÑÏù¥ÎûÄ')">üìÖ Ïã†Ïö©Í≥µÏó¨Í∏∞Í∞Ñ</button>
                        </div>
                        
                        <!-- Settings Dropdown -->
                        <div class="settings-container" style="position: relative;">
                            <div class="settings-toggle" onclick="toggleChatSettings()">
                                <i class="fas fa-cog"></i>
                                <span>ÏÑ§Ï†ï</span>
                                <i class="fas fa-chevron-down" id="settingsChevron"></i>
                            </div>
                            <div class="settings-dropdown" id="chatSettingsDropdown">
                                <div class="settings-row">
                                    <span class="setting-label">LLM Î™®Îç∏</span>
                                    <div class="setting-control">
                                        <select id="llmModelHeader" class="form-select form-select-sm" onchange="syncLLMModel()">
                                            <option value="gpt-4o-mini">GPT-4o-mini</option>
                                            <option value="gpt-4-turbo">GPT-4.1-mini</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="settings-row">
                                    <span class="setting-label">ÎåÄÌôî Í∏∞Î°ù ÏÇ¨Ïö©</span>
                                    <div class="setting-control">
                                        <input type="checkbox" id="useMemoryHeader" onchange="syncMemorySettings()">
                                    </div>
                                </div>
                                <div class="settings-row">
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearChat()">
                                        <i class="fas fa-eraser"></i> ÎåÄÌôî Ï¥àÍ∏∞Ìôî
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-container" id="chatContainer">
                    <div class="message ai-message">
                        <h3>üöÄ RAG QA SystemÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</h3>
                        <p><strong>ÏÇ¨Ïö©Î≤ï:</strong></p>
                        <ol>
                            <li>üìÅ <strong>S3 Ìè¥Îçî Î°úÎìú</strong> ÎòêÎäî ÏßÅÏ†ë ÌååÏùº ÏóÖÎ°úÎìú</li>
                            <li>ü§ñ <strong>LLM Î™®Îç∏</strong> ÏÑ†ÌÉù (GPT-4o-mini Ï∂îÏ≤ú)</li>
                            <li>‚ùì <strong>ÏßàÎ¨∏ ÏûÖÎ†•</strong> ÌõÑ Ï†ÑÏÜ°</li>
                        </ol>
                        <p><em>ÏòàÏãú: "Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂úÏù¥ÎûÄ?", "Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú Ïù¥Ïö©Î∞©Î≤ï"</em></p>
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="questionInput" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." onkeypress="handleKeyPress(event)" rows="1" style="resize: none; overflow-y: auto;"></textarea>
                        <button class="send-button" onclick="sendQuestion()" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating Buttons -->
    <a href="/swagger/" class="api-link" target="_blank">
        <i class="fas fa-code"></i> API
    </a>
    
    <!-- Admin Settings Button -->
    <button class="admin-settings-btn" onclick="showAdminLogin()">
        <i class="fas fa-cog"></i>
    </button>
    
    <!-- Admin Login Modal -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="admin-close" onclick="closeAdminModal()">&times;</span>
            <h2><i class="fas fa-lock"></i> Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï</h2>
            
            <!-- Login Form -->
            <div id="adminLoginForm" class="admin-form">
                <input type="password" id="adminPassword" placeholder="Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•" onkeypress="if(event.key==='Enter') adminLogin()">
                <button onclick="adminLogin()" class="admin-btn">Î°úÍ∑∏Ïù∏</button>
            </div>
            
            <!-- Settings Panel -->
            <div id="adminSettingsPanel" style="display:none;">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('cache')">Ï∫êÏãú ÏÑ§Ï†ï</button>
                    <button class="admin-tab" onclick="switchAdminTab('chunk')">Ï≤≠ÌÅ¨ Ï†ÑÎûµ</button>
                    <button class="admin-tab" onclick="switchAdminTab('redis')">Redis ÏÑ§Ï†ï</button>
                    <button class="admin-tab" onclick="switchAdminTab('password')">ÎπÑÎ∞ÄÎ≤àÌò∏</button>
                </div>
                
                <!-- Cache Settings Tab -->
                <div id="cacheTab" class="admin-tab-content active">
                    <h3>ÌïòÏù¥Î∏åÎ¶¨Îìú Ï∫êÏãú ÏãúÏä§ÌÖú</h3>
                    <div class="cache-info">
                        <p><strong>üöÄ Redis + RDB ÌïòÏù¥Î∏åÎ¶¨Îìú</strong></p>
                        <p>‚Ä¢ Redis: 24ÏãúÍ∞Ñ ÏûÑÏãú Ï∫êÏãú</p>
                        <p>‚Ä¢ RDB: Ïù∏Í∏∞ ÏßàÎ¨∏ ÏòÅÍµ¨ Ï†ÄÏû•</p>
                        <p>‚Ä¢ ÏûêÎèô Î¨∏ÏÑú Î≥ÄÍ≤Ω Í∞êÏßÄ</p>
                    </div>
                    
                    <div class="admin-setting-group">
                        <label>Ïù∏Í∏∞ ÏßàÎ¨∏ Í∏∞Ï§Ä (Ï°∞ÌöåÏàò)</label>
                        <input type="number" id="popularThreshold" value="5" min="2" max="20">
                        <small>Ïù¥ ÌöüÏàò Ïù¥ÏÉÅ Ï°∞ÌöåÎêú ÏßàÎ¨∏ÏùÄ RDBÏóê ÏòÅÍµ¨ Ï†ÄÏû•Îê©ÎãàÎã§</small>
                    </div>
                    
                    <div class="admin-setting-group">
                        <label>Redis TTL (ÏãúÍ∞Ñ)</label>
                        <input type="number" id="cacheTTL" value="24" min="1" max="168">
                        <small>Redis ÏûÑÏãú Ï∫êÏãú Ïú†ÏßÄ ÏãúÍ∞Ñ</small>
                    </div>
                    
                    <div class="admin-actions-inline">
                        <button onclick="validateDocuments()" class="admin-btn-small">
                            <i class="fas fa-sync"></i> Î¨∏ÏÑú Î≥ÄÍ≤Ω Í∞êÏßÄ
                        </button>
                        <button onclick="loadCacheStats()" class="admin-btn-small">
                            <i class="fas fa-chart-bar"></i> Ï∫êÏãú ÌÜµÍ≥Ñ
                        </button>
                    </div>
                    
                    <div id="cacheStatsDisplay" class="cache-stats-display" style="display:none;">
                        <!-- Ï∫êÏãú ÌÜµÍ≥ÑÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                    
                    <div class="cache-status" id="cacheStatus">
                        ÌòÑÏû¨ ÏãúÏä§ÌÖú: <span id="currentCacheType">ÌïòÏù¥Î∏åÎ¶¨Îìú Ï∫êÏãú</span>
                    </div>
                </div>
                
                <!-- Chunk Strategy Tab -->
                <div id="chunkTab" class="admin-tab-content">
                    <h3>Ï≤≠ÌÅ¨ Ï†ÑÎûµ ÏÑ§Ï†ï</h3>
                    <div class="admin-setting-group">
                        <label>Ï≤≠ÌÅ¨ ÌÅ¨Í∏∞</label>
                        <input type="number" id="chunkSize" value="1000" min="100" max="5000">
                    </div>
                    <div class="admin-setting-group">
                        <label>Ï≤≠ÌÅ¨ Í≤πÏπ®</label>
                        <input type="number" id="chunkOverlap" value="200" min="0" max="500">
                    </div>
                    <div class="admin-setting-group">
                        <label>Íµ¨Î∂ÑÏûê</label>
                        <select id="chunkSeparator" class="admin-select">
                            <option value="\n\n">Ïù¥Ï§ë Ï§ÑÎ∞îÍøà</option>
                            <option value="\n">Îã®Ïùº Ï§ÑÎ∞îÍøà</option>
                            <option value=". ">ÎßàÏπ®Ìëú</option>
                        </select>
                    </div>
                </div>
                
                <!-- Redis Settings Tab -->
                <div id="redisTab" class="admin-tab-content">
                    <h3>Redis Ïó∞Í≤∞ ÏÑ§Ï†ï</h3>
                    <div class="admin-setting-group">
                        <label>Ìò∏Ïä§Ìä∏</label>
                        <input type="text" id="redisHost" value="localhost">
                    </div>
                    <div class="admin-setting-group">
                        <label>Ìè¨Ìä∏</label>
                        <input type="number" id="redisPort" value="6379">
                    </div>
                    <div class="admin-setting-group">
                        <label>ÎπÑÎ∞ÄÎ≤àÌò∏ (ÏÑ†ÌÉù)</label>
                        <input type="password" id="redisPassword" placeholder="Redis ÎπÑÎ∞ÄÎ≤àÌò∏">
                    </div>
                    <button onclick="testRedisConnection()" class="admin-btn-small">Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                    <div id="redisTestResult"></div>
                </div>
                
                <!-- Password Tab -->
                <div id="passwordTab" class="admin-tab-content">
                    <h3>ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</h3>
                    <div class="admin-setting-group">
                        <label>ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                        <input type="password" id="newPassword" placeholder="ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅ">
                    </div>
                    <div class="admin-setting-group">
                        <label>ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
                        <input type="password" id="confirmPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏûÖÎ†•">
                    </div>
                    <button onclick="changePassword()" class="admin-btn-small">Î≥ÄÍ≤Ω</button>
                </div>
                
                <!-- Save Button -->
                <div class="admin-actions">
                    <button onclick="saveAdminSettings()" class="admin-btn admin-save">
                        <i class="fas fa-save"></i> ÏÑ§Ï†ï Ï†ÄÏû•
                    </button>
                    <button onclick="adminLogout()" class="admin-btn admin-logout">
                        <i class="fas fa-sign-out-alt"></i> Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        let isLoading = false;

        window.onload = function() {
            loadDocumentList();
            loadVectorDBInfo();
            setupTextareaAutoResize();
            loadChatHistory();
            startNewChat(); // Ï¥àÍ∏∞ Ï±ÑÌåÖ ÏãúÏûë
            
            // Sync initial settings
            const leftLLMModel = document.getElementById('llmModel');
            
            if (leftLLMModel) {
                document.getElementById('llmModelHeader').value = leftLLMModel.value;
            }
        };
        
        function renderSimilarityPanel(similarityData, query, cacheInfo = null) {
            let panel = `<div class="similarity-panel">
                <div class="similarity-header">
                    <i class="fas fa-search"></i>Ïú†ÏÇ¨ÎèÑ Í≤ÄÏÉâ Í≤∞Í≥º (${similarityData.total_results}Í∞ú Ï§ë ÏÉÅÏúÑ 3Í∞ú)
                </div>
                <div class="query-highlight">
                    <i class="fas fa-question-circle"></i> ÏßàÏùò: "${query}"
                </div>`;
            
            // Add cache source info if available
            if (cacheInfo) {
                let cacheSourceText = '';
                let cacheSourceColor = '';
                
                if (cacheInfo.source === 'redis') {
                    cacheSourceText = `‚ö° Redis Ï∫êÏãúÏóêÏÑú Í∞ÄÏ†∏Ïò¥ (${cacheInfo.hit_count}Ìöå Ï°∞Ìöå)`;
                    cacheSourceColor = '#ffc107';
                } else if (cacheInfo.source === 'popular_db') {
                    cacheSourceText = `‚≠ê Ïù∏Í∏∞ÏßàÎ¨∏ DBÏóêÏÑú Í∞ÄÏ†∏Ïò¥ (${cacheInfo.hit_count}Ìöå Ï°∞Ìöå)`;
                    cacheSourceColor = '#28a745';
                }
                
                panel += `<div style="background: ${cacheSourceColor}22; border-left: 3px solid ${cacheSourceColor}; padding: 8px 12px; margin: 10px 0; border-radius: 6px; font-size: 12px;">
                    ${cacheSourceText}
                </div>`;
            }
            
            similarityData.top_matches.forEach((match, index) => {
                const scoreColor = match.similarity_percentage >= 80 ? '#28a745' : 
                                 match.similarity_percentage >= 60 ? '#ffc107' : '#dc3545';
                
                panel += `<div class="similarity-item">
                    <div class="similarity-rank">${match.rank}</div>
                    <div class="similarity-score">
                        <span class="score-badge">${match.similarity_percentage}%</span>
                        <div class="score-bar">
                            <div class="score-progress" style="width: ${match.similarity_percentage}%; background: linear-gradient(90deg, ${scoreColor}, ${scoreColor}aa)"></div>
                        </div>
                        <small style="color: ${scoreColor}; font-weight: 600;">${match.similarity_score}</small>
                    </div>
                    <div class="similarity-preview">${match.content_preview}</div>
                    <div class="similarity-source">
                        <i class="fas fa-file-alt"></i> ${match.document_title}
                    </div>
                    <div class="similarity-meta">
                        <span>Ï∂úÏ≤ò: ${match.document_source}</span>
                    </div>
                </div>`;
            });
            
            panel += '</div>';
            return panel;
        }

        function toggleTextInput() {
            const section = document.getElementById('textInputSection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isLoading) {
                sendQuestion();
            }
        }

        // Enhanced markdown formatting
        function formatMarkdown(text) {
            text = formatTables(text);
            text = text.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            text = text.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            text = text.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            text = formatLists(text);
            text = text.replace(/\n\n/g, '</p><p>');
            text = '<p>' + text + '</p>';
            text = text.replace(/<p><\/p>/g, '');
            text = text.replace(/<p>(<[h|t|u|o])/g, '$1');
            text = text.replace(/(<\/[h|t|u|o][^>]*>)<\/p>/g, '$1');
            return text;
        }

        function formatTables(text) {
            const tablePattern = /(\|[^|\n]*\|[^|\n]*\|[^\n]*\n)+/g;
            return text.replace(tablePattern, (match) => {
                const rows = match.trim().split('\n');
                if (rows.length < 2) return match;
                
                let table = '<table class="table table-sm table-striped">';
                let hasHeader = false;
                
                rows.forEach((row, index) => {
                    if (row.includes('---')) {
                        hasHeader = true;
                        return;
                    }
                    
                    const cells = row.split('|').map(cell => cell.trim()).filter(cell => cell !== '');
                    if (cells.length === 0) return;
                    
                    const isHeader = (index === 0 && !hasHeader);
                    const tag = isHeader ? 'th' : 'td';
                    
                    if (isHeader) table += '<thead>';
                    else if (index === 1 && hasHeader) table += '</thead><tbody>';
                    else if (index === 1) table += '<tbody>';
                    
                    table += '<tr>';
                    cells.forEach(cell => {
                        let cellContent = cell.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                        table += `<${tag}>${cellContent}</${tag}>`;
                    });
                    table += '</tr>';
                });
                
                table += hasHeader ? '</tbody></table>' : '</tbody></table>';
                return table;
            });
        }

        function formatLists(text) {
            const lines = text.split('\n');
            let result = [];
            let inList = false;
            let listType = '';
            
            for (let line of lines) {
                const isCheckItem = /^\s*[-*+]\s*‚úÖ\s*(.+)/.test(line);
                const isUnorderedItem = /^\s*[-*+]\s+(.+)/.test(line);
                const isOrderedItem = /^\s*\d+\.\s+(.+)/.test(line);
                
                if (isCheckItem) {
                    const content = line.replace(/^\s*[-*+]\s*‚úÖ\s*/, '');
                    if (!inList || listType !== 'check') {
                        if (inList) result.push(`</${listType}>`);
                        result.push('<ul class="list-check">');
                        inList = true;
                        listType = 'check';
                    }
                    result.push(`<li><i class="fas fa-check-circle text-success"></i> ${content}</li>`);
                } else if (isUnorderedItem) {
                    const content = line.replace(/^\s*[-*+]\s+/, '');
                    if (!inList || listType !== 'ul') {
                        if (inList) result.push(`</${listType}>`);
                        result.push('<ul>');
                        inList = true;
                        listType = 'ul';
                    }
                    result.push(`<li>${content}</li>`);
                } else if (isOrderedItem) {
                    const content = line.replace(/^\s*\d+\.\s+/, '');
                    if (!inList || listType !== 'ol') {
                        if (inList) result.push(`</${listType}>`);
                        result.push('<ol>');
                        inList = true;
                        listType = 'ol';
                    }
                    result.push(`<li>${content}</li>`);
                } else {
                    if (inList) {
                        result.push(`</${listType}>`);
                        inList = false;
                        listType = '';
                    }
                    result.push(line);
                }
            }
            
            if (inList) result.push(`</${listType}>`);
            return result.join('\n');
        }

        async function sendQuestion() {
            if (isLoading) return;
            
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            if (!question) return;

            isLoading = true;
            const chatContainer = document.getElementById('chatContainer');
            const useMemoryHeader = document.getElementById('useMemoryHeader');
            const useMemory = useMemoryHeader ? useMemoryHeader.checked : false;
            const llmModelHeader = document.getElementById('llmModelHeader');
            const llmModel = llmModelHeader ? llmModelHeader.value : 'gpt-4o-mini';

            // Add user message
            chatContainer.innerHTML += `<div class="message user-message">${question}</div>`;
            
            // Add loading indicator
            chatContainer.innerHTML += `<div class="message ai-message" id="loadingMsg"><div class="loading"></div> ÏÉùÍ∞ÅÌïòÎäî Ï§ë...</div>`;
            input.value = '';
            input.style.height = 'auto'; // ÌÉúÏä§ÌÅ¨ÏóêÎ¶¨ÏïÑ ÎÜíÏù¥ Î¶¨ÏÖã
            document.getElementById('sendButton').disabled = true; // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                const response = await fetch('/api/rag/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        question: question,
                        use_memory: useMemory,
                        llm_model: llmModel
                    })
                });

                const data = await response.json();
                
                // Remove loading message
                document.getElementById('loadingMsg').remove();
                
                if (data.error) {
                    let errorHTML = `<div class="message ai-message error-message">
                        <h3>üö® ${data.title || 'Ïò§Î•ò Î∞úÏÉù'}</h3>`;
                    
                    if (data.error_code) {
                        errorHTML += `<div class="error-code">Ïò§Î•ò ÏΩîÎìú: ${data.error_code}</div>`;
                    }
                    
                    errorHTML += `<p><strong>Î¨∏Ï†ú:</strong> ${data.message || data.error}</p>`;
                    
                    if (data.solution) {
                        errorHTML += `<div class="error-solution">
                            <strong>üí° Ìï¥Í≤∞ Î∞©Î≤ï:</strong><br>
                            ${data.solution.replace(/\n/g, '<br>')}
                        </div>`;
                    }
                    
                    errorHTML += `</div>`;
                    chatContainer.innerHTML += errorHTML;
                } else {
                    const formattedAnswer = formatMarkdown(data.answer);
                    let aiMessage = `<div class="message ai-message">${formattedAnswer}`;
                    
                    // Add cache indicator with source info
                    if (data._from_cache || data._cache_source) {
                        let cacheIcon = '';
                        let cacheText = '';
                        let cacheColor = '';
                        
                        if (data._cache_source === 'redis') {
                            cacheIcon = '<i class="fas fa-bolt"></i>';
                            cacheText = 'Redis Ï∫êÏãú (ÏûÑÏãú)';
                            cacheColor = 'linear-gradient(135deg, #ffc107, #ff9800)';
                        } else if (data._cache_source === 'popular_db') {
                            cacheIcon = '<i class="fas fa-star"></i>';
                            cacheText = 'Ïù∏Í∏∞ÏßàÎ¨∏ DB (ÏòÅÍµ¨)';
                            cacheColor = 'linear-gradient(135deg, #28a745, #20c997)';
                        } else if (data._from_cache) {
                            cacheIcon = '<i class="fas fa-bolt"></i>';
                            cacheText = 'Ï∫êÏãúÎêú ÏùëÎãµ';
                            cacheColor = 'linear-gradient(135deg, #ffc107, #ff9800)';
                        }
                        
                        aiMessage += `<div class="cache-indicator" style="background: ${cacheColor}">
                            ${cacheIcon} ${cacheText}
                            ${data._hit_count ? `| Ï°∞ÌöåÏàò: ${data._hit_count}Ìöå` : ''}
                        </div>`;
                    }
                    
                    aiMessage += `<div class="mt-2"><small class="text-muted">ü§ñ ${data.model_used || llmModel}</small></div>`;
                    
                    if (data.source_documents && data.source_documents.length > 0) {
                        aiMessage += '<div class="source-doc"><strong>üìÑ Ï∞∏Í≥†:</strong> ';
                        data.source_documents.slice(0, 2).forEach((doc, idx) => {
                            aiMessage += `${doc.metadata.source_file || doc.metadata.title || doc.metadata.filename || 'Unknown'}${idx < 1 && data.source_documents.length > 1 ? ', ' : ''}`;
                        });
                        if (data.source_documents.length > 2) aiMessage += ` Ïô∏ ${data.source_documents.length - 2}Í∞ú`;
                        aiMessage += '</div>';
                    }
                    
                    // Add similarity search panel (always show if available)
                    if (data.similarity_search && data.similarity_search.top_matches && data.similarity_search.top_matches.length > 0) {
                        // Add cache source info to similarity panel
                        const cacheInfo = data._cache_source ? {
                            source: data._cache_source,
                            hit_count: data._hit_count || 0
                        } : null;
                        
                        aiMessage += renderSimilarityPanel(data.similarity_search, question, cacheInfo);
                    }
                    
                    aiMessage += '</div>';
                    chatContainer.innerHTML += aiMessage;
                    
                    // Ï±ÑÌåÖ ÏÑ∏ÏÖò ÏóÖÎç∞Ïù¥Ìä∏ (Ï≤´ Î≤àÏß∏ ÏßàÎ¨∏Ïù¥Î©¥ Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏)
                    if (currentChatId && chatSessions[currentChatId]) {
                        if (chatSessions[currentChatId].title === 'ÏÉà Ï±ÑÌåÖ') {
                            chatSessions[currentChatId].title = question.length > 30 ? question.substring(0, 30) + '...' : question;
                            updateChatHistory();
                        }
                        chatSessions[currentChatId].updatedAt = new Date();
                    }
                }
            } catch (error) {
                document.getElementById('loadingMsg').remove();
                chatContainer.innerHTML += `<div class="message ai-message">‚ùå Ïó∞Í≤∞ Ïò§Î•ò: ${error.message}</div>`;
            }

            isLoading = false;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Ï±ÑÌåÖ ÏÑ∏ÏÖò Ï†ÄÏû•
            if (currentChatId) {
                saveChatSession(currentChatId);
                updateChatHistory();
            }
        }

        async function loadS3Documents() {
            if (isLoading) return;
            isLoading = true;
            
            const s3LoadBtn = document.getElementById('s3LoadBtn');
            const chatContainer = document.getElementById('chatContainer');
            
            // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
            const originalBtnContent = s3LoadBtn.innerHTML;
            s3LoadBtn.innerHTML = '<div class="loading"></div> Î°úÎî© Ï§ë...';
            s3LoadBtn.disabled = true;
            
            // Ï±ÑÌåÖÏ∞ΩÏóê Î°úÎî© Î©îÏãúÏßÄ Ï∂îÍ∞Ä
            const loadingMessageId = 'loading-msg-' + Date.now();
            chatContainer.innerHTML += `<div class="message ai-message loading-message" id="${loadingMessageId}">
                <h3><div class="loading-spinner"></div> S3 Ìè¥Îçî Î°úÎî© Ï§ë...</h3>
                <p>Î¨∏ÏÑúÎ•º Î∂àÎü¨ÏôÄÏÑú Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî...</p>
                <div class="loading-progress">
                    <div class="progress-bar"></div>
                </div>
            </div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const response = await fetch('/api/document/load-s3', { method: 'POST' });
                const data = await response.json();
                
                // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                document.getElementById(loadingMessageId)?.remove();
                
                if (data.error) {
                    chatContainer.innerHTML += `<div class="message ai-message error-message">
                        <h3>üö® S3 Ìè¥Îçî Î°úÎìú Ïã§Ìå®</h3>
                        <p>${data.error}</p>
                    </div>`;
                } else {
                    // ÏÑ±Í≥µ Î©îÏãúÏßÄÎ•º Ï±ÑÌåÖÏ∞ΩÏóê ÌëúÏãú
                    chatContainer.innerHTML += `<div class="message ai-message success-message">
                        <h3>‚úÖ S3 Ìè¥Îçî Î°úÎìú ÏôÑÎ£å</h3>
                        <p><strong>${data.documents_loaded || 0}Í∞ú Î¨∏ÏÑú</strong>Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î°úÎìúÎêòÏñ¥ <strong>${data.total_chunks || 0}Í∞ú Ï≤≠ÌÅ¨</strong>Î°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.</p>
                        <p>üéØ Ïù¥Ï†ú BCÏπ¥Îìú Í¥ÄÎ†® ÏßàÎ¨∏ÏùÑ ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§!</p>
                        <div class="completion-animation">üéâ</div>
                    </div>`;
                    
                    loadDocumentList();
                    loadVectorDBInfo();
                }
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                document.getElementById(loadingMessageId)?.remove();
                
                chatContainer.innerHTML += `<div class="message ai-message error-message">
                    <h3>üö® Ïó∞Í≤∞ Ïò§Î•ò</h3>
                    <p>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}</p>
                </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            } finally {
                // Î≤ÑÌäº ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                s3LoadBtn.innerHTML = originalBtnContent;
                s3LoadBtn.disabled = false;
                isLoading = false;
            }
        }

        async function uploadDocument() {
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const chatContainer = document.getElementById('chatContainer');
            const file = fileInput.files[0];
            if (!file) return;

            // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
            const originalBtnContent = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<div class="loading"></div>';
            uploadBtn.disabled = true;
            fileInput.disabled = true;

            // Ï±ÑÌåÖÏ∞ΩÏóê Î°úÎî© Î©îÏãúÏßÄ Ï∂îÍ∞Ä
            const loadingMessageId = 'upload-loading-' + Date.now();
            chatContainer.innerHTML += `<div class="message ai-message loading-message" id="${loadingMessageId}">
                <h3><div class="loading-spinner"></div> ÌååÏùº ÏóÖÎ°úÎìú Ï§ë...</h3>
                <p><strong>${file.name}</strong> ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</p>
                <div class="loading-progress">
                    <div class="progress-bar"></div>
                </div>
            </div>`;
            chatContainer.scrollTop = chatContainer.scrollHeight;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/document/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                document.getElementById(loadingMessageId)?.remove();
                
                if (data.error) {
                    chatContainer.innerHTML += `<div class="message ai-message error-message">
                        <h3>üö® ÌååÏùº ÏóÖÎ°úÎìú Ïã§Ìå®</h3>
                        <p>${data.error}</p>
                    </div>`;
                } else {
                    // ÏÑ±Í≥µ Î©îÏãúÏßÄÎ•º Ï±ÑÌåÖÏ∞ΩÏóê ÌëúÏãú
                    chatContainer.innerHTML += `<div class="message ai-message success-message">
                        <h3>‚úÖ ÌååÏùº ÏóÖÎ°úÎìú ÏôÑÎ£å</h3>
                        <p><strong>${data.filename || 'ÌååÏùº'}</strong> ÌååÏùºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎ°úÎìúÎêòÏñ¥ <strong>${data.chunks_created || 0}Í∞ú Ï≤≠ÌÅ¨</strong>Î°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.</p>
                        <div class="completion-animation">üéâ</div>
                    </div>`;
                    
                    fileInput.value = '';
                    loadDocumentList();
                    loadVectorDBInfo();
                }
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
            } catch (error) {
                // Î°úÎî© Î©îÏãúÏßÄ Ï†úÍ±∞
                document.getElementById(loadingMessageId)?.remove();
                
                chatContainer.innerHTML += `<div class="message ai-message error-message">
                    <h3>üö® ÏóÖÎ°úÎìú Ïò§Î•ò</h3>
                    <p>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}</p>
                </div>`;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            } finally {
                // Î≤ÑÌäºÍ≥º ÏûÖÎ†• ÌïÑÎìú ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                uploadBtn.innerHTML = originalBtnContent;
                uploadBtn.disabled = false;
                fileInput.disabled = false;
            }
        }

        async function uploadText() {
            const textInput = document.getElementById('textInput');
            const titleInput = document.getElementById('textTitle');
            const text = textInput.value.trim();
            const title = titleInput.value.trim() || 'Direct Input ' + new Date().toLocaleTimeString();
            
            if (!text) return;

            try {
                const response = await fetch('/api/document/upload-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, title })
                });

                const data = await response.json();
                if (data.error) {
                    alert(`‚ùå ${data.error}`);
                } else {
                    // ÏÑ±Í≥µ Î©îÏãúÏßÄÎ•º Ï±ÑÌåÖÏ∞ΩÏóê ÌëúÏãú
                    const chatContainer = document.getElementById('chatContainer');
                    chatContainer.innerHTML += `<div class="message ai-message success-message">
                        <h3>‚úÖ ÌÖçÏä§Ìä∏ Ï∂îÍ∞Ä ÏôÑÎ£å</h3>
                        <p><strong>${data.title || 'ÌÖçÏä§Ìä∏'}</strong> ÌÖçÏä§Ìä∏Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏñ¥ <strong>${data.chunks_created || 0}Í∞ú Ï≤≠ÌÅ¨</strong>Î°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.</p>
                    </div>`;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    textInput.value = '';
                    titleInput.value = '';
                    toggleTextInput();
                    loadDocumentList();
                    loadVectorDBInfo();
                }
            } catch (error) {
                alert(`‚ùå ${error.message}`);
            }
        }

        async function loadDocumentList() {
            try {
                const response = await fetch('/api/document/list');
                const data = await response.json();
                
                const listContainer = document.getElementById('documentList');
                let html = '';
                
                // Î≤°ÌÑ∞DB ÏÉÅÌÉú ÌëúÏãú
                if (!data.has_documents) {
                    html += `<div class="document-status empty">
                        <div class="status-icon">‚ö†Ô∏è</div>
                        <div class="status-text">
                            <strong>Î¨∏ÏÑúÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùå</strong><br>
                            <small>S3 Ìè¥Îçî Î°úÎìú ÎòêÎäî ÌååÏùº ÏóÖÎ°úÎìú ÌïÑÏöî</small>
                        </div>
                    </div>`;
                } else {
                    html += `<div class="document-status loaded">
                        <div class="status-icon">‚úÖ</div>
                        <div class="status-text">
                            <strong>Î¨∏ÏÑú Î°úÎìú ÏôÑÎ£å</strong><br>
                            <small>${data.total_chunks}Í∞ú Ï≤≠ÌÅ¨ Ï§ÄÎπÑÎê®</small>
                        </div>
                    </div>`;
                }
                
                // S3 Ìè¥Îçî Î¨∏ÏÑú ÌëúÏãú
                if (data.s3_files && data.s3_files.length > 0) {
                    html += `<div class="document-section">
                        <div class="section-header">üìÅ S3 Ìè¥Îçî (${data.s3_files.length}Í∞ú)</div>`;
                    data.s3_files.slice(0, 3).forEach(file => {
                        html += `<div class="document-item s3-file">
                            <span>üìÑ ${file.filename.length > 18 ? file.filename.substring(0, 18) + '...' : file.filename}</span>
                            <small class="s3-badge">S3</small>
                        </div>`;
                    });
                    if (data.s3_files.length > 3) {
                        html += `<div class="text-center text-muted"><small>+${data.s3_files.length - 3}Í∞ú Îçî</small></div>`;
                    }
                    html += '</div>';
                }
                
                // ÏóÖÎ°úÎìúÎêú ÌååÏùº ÌëúÏãú
                if (data.files && data.files.length > 0) {
                    html += `<div class="document-section">
                        <div class="section-header">üì§ ÏóÖÎ°úÎìú (${data.files.length}Í∞ú)</div>`;
                    data.files.slice(0, 2).forEach(file => {
                        html += `<div class="document-item">
                            <span>üìÑ ${file.filename.length > 18 ? file.filename.substring(0, 18) + '...' : file.filename}</span>
                            <small>${(file.size / 1024).toFixed(1)}KB</small>
                        </div>`;
                    });
                    if (data.files.length > 2) {
                        html += `<div class="text-center text-muted"><small>+${data.files.length - 2}Í∞ú Îçî</small></div>`;
                    }
                    html += '</div>';
                }
                
                if (!data.s3_files?.length && !data.files?.length) {
                    html += '<div class="text-center text-muted"><small>Î¨∏ÏÑú ÏóÜÏùå</small></div>';
                }
                
                listContainer.innerHTML = html;
            } catch (error) {
                console.error('Î¨∏ÏÑú Î™©Î°ù Î°úÎìú Ïã§Ìå®:', error);
                document.getElementById('documentList').innerHTML = 
                    '<div class="text-center text-danger"><small>Î°úÎìú Ïã§Ìå®</small></div>';
            }
        }

        async function loadVectorDBInfo() {
            try {
                const response = await fetch('/api/rag/vectordb/info');
                const data = await response.json();
                
                document.getElementById('vectorDbInfo').innerHTML = `üìä ${data.total_documents}Í∞ú Î¨∏ÏÑú`;
            } catch (error) {
                console.error('Î≤°ÌÑ∞DB Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', error);
            }
        }

        async function clearVectorDB() {
            if (!confirm('Î≤°ÌÑ∞DBÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch('/api/rag/vectordb/clear', { method: 'DELETE' });
                const data = await response.json();
                alert('‚úÖ Î≤°ÌÑ∞DB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                loadDocumentList();
                loadVectorDBInfo();
            } catch (error) {
                alert(`‚ùå ${error.message}`);
            }
        }

        async function clearAllDocuments() {
            if (!confirm('Î™®Îì† Î¨∏ÏÑúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                const response = await fetch('/api/document/clear-all', { method: 'DELETE' });
                alert('‚úÖ Î¨∏ÏÑú ÏÇ≠Ï†ú ÏôÑÎ£å');
                loadDocumentList();
                loadVectorDBInfo();
            } catch (error) {
                alert(`‚ùå ${error.message}`);
            }
        }

        function askQuestion(question) {
            if (isLoading) return;
            
            const input = document.getElementById('questionInput');
            input.value = question;
            sendQuestion();
        }

        function clearChat() {
            // ÏÉà Ï±ÑÌåÖ ÏãúÏûë (Í∏∞Ï°¥ clearChat ÎåÄÏã†)
            startNewChat();
        }
        
        // Chat settings functions
        function toggleChatSettings() {
            const dropdown = document.getElementById('chatSettingsDropdown');
            const chevron = document.getElementById('settingsChevron');
            
            if (dropdown.style.display === 'none' || !dropdown.style.display) {
                dropdown.style.display = 'block';
                chevron.style.transform = 'rotate(180deg)';
            } else {
                dropdown.style.display = 'none';
                chevron.style.transform = 'rotate(0deg)';
            }
        }
        
        function syncLLMModel() {
            const headerModel = document.getElementById('llmModelHeader').value;
            const leftPanelModel = document.getElementById('llmModel');
            if (leftPanelModel) {
                leftPanelModel.value = headerModel;
            }
        }
        
        function syncMemorySettings() {
            const headerMemory = document.getElementById('useMemoryHeader').checked;
            const leftPanelMemory = document.getElementById('useMemory');
            if (leftPanelMemory) {
                leftPanelMemory.checked = headerMemory;
            }
        }
        
        // Auto-resize textarea
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('questionInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 200) + 'px';
                
                // Enable/disable send button based on content
                const sendButton = document.getElementById('sendButton');
                sendButton.disabled = !this.value.trim();
            });
            
            // Initialize button state
            document.getElementById('sendButton').disabled = true;
        }
        
        // Chat Session Functions
        function startNewChat() {
            // Í∏∞Ï°¥ Ï±ÑÌåÖ Ï†ÄÏû•
            if (currentChatId && chatSessions[currentChatId]) {
                saveChatSession(currentChatId);
            }
            
            // ÏÉà Ï±ÑÌåÖ ID ÏÉùÏÑ±
            currentChatId = 'chat_' + Date.now();
            
            // ÏÉà Ï±ÑÌåÖ ÏÑ∏ÏÖò ÏÉùÏÑ±
            chatSessions[currentChatId] = {
                id: currentChatId,
                title: 'ÏÉà Ï±ÑÌåÖ',
                messages: [],
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            // Ï±ÑÌåÖ ÏªµÌÖåÏù¥ÎÑà Ï¥àÍ∏∞Ìôî
            document.getElementById('chatContainer').innerHTML = 
                `<div class="message ai-message">
                    <h3>üöÄ ÏÉà Ï±ÑÌåÖÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!</h3>
                    <p><strong>ÏÇ¨Ïö©Î≤ï:</strong></p>
                    <ol>
                        <li>üìÅ <strong>S3 Ìè¥Îçî Î°úÎìú</strong> ÎòêÎäî ÏßÅÏ†ë ÌååÏùº ÏóÖÎ°úÎìú</li>
                        <li>ü§ñ <strong>LLM Î™®Îç∏</strong> ÏÑ†ÌÉù (GPT-4o-mini Ï∂îÏ≤ú)</li>
                        <li>‚ùì <strong>ÏßàÎ¨∏ ÏûÖÎ†•</strong> ÌõÑ Ï†ÑÏÜ°</li>
                    </ol>
                    <p><em>ÏòàÏãú: "Ïû•Í∏∞Ïπ¥ÎìúÎåÄÏ∂úÏù¥ÎûÄ?", "Îã®Í∏∞Ïπ¥ÎìúÎåÄÏ∂ú Ïù¥Ïö©Î∞©Î≤ï"</em></p>
                    <div class="cache-indicator" style="background: linear-gradient(135deg, #10a37f, #0d8c6b); margin-top: 15px;">
                        <i class="fas fa-database"></i> Redis Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞Îäî Î™®Îì† ÏÇ¨Ïö©ÏûêÍ∞Ä Í≥µÏú†Ìï©ÎãàÎã§
                    </div>
                </div>`;
            
            // Ï±ÑÌåÖ Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateChatHistory();
            
            // Ï£ºÏùò: Î©îÎ™®Î¶¨Îßå Ï¥àÍ∏∞Ìôî, Redis Ï∫êÏãúÎäî Ïú†ÏßÄÌïòÏó¨ Î™®Îì† ÏÇ¨Ïö©ÏûêÍ∞Ä Í≥µÏú†
            fetch('/api/chat/clear-memory', { method: 'POST' });
        }
        
        function saveChatSession(chatId) {
            if (!chatSessions[chatId]) return;
            
            const chatContainer = document.getElementById('chatContainer');
            const messages = Array.from(chatContainer.children);
            
            chatSessions[chatId].messages = messages.map(msg => ({
                content: msg.innerHTML,
                className: msg.className,
                timestamp: new Date()
            }));
            
            chatSessions[chatId].updatedAt = new Date();
            
            // Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄÎ°ú Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            const firstUserMessage = messages.find(msg => msg.classList.contains('user-message'));
            if (firstUserMessage && chatSessions[chatId].title === 'ÏÉà Ï±ÑÌåÖ') {
                const text = firstUserMessage.textContent || firstUserMessage.innerText;
                chatSessions[chatId].title = text.length > 30 ? text.substring(0, 30) + '...' : text;
            }
            
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            localStorage.setItem('chatSessions', JSON.stringify(chatSessions));
        }
        
        function loadChatSession(chatId) {
            if (!chatSessions[chatId]) return;
            
            // Í∏∞Ï°¥ Ï±ÑÌåÖ Ï†ÄÏû•
            if (currentChatId && currentChatId !== chatId) {
                saveChatSession(currentChatId);
            }
            
            currentChatId = chatId;
            const session = chatSessions[chatId];
            
            // Ï±ÑÌåÖ ÏªµÌÖåÏù¥ÎÑàÏóê Î©îÏãúÏßÄ Î≥µÏõê
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            session.messages.forEach(msgData => {
                const messageDiv = document.createElement('div');
                messageDiv.className = msgData.className;
                messageDiv.innerHTML = msgData.content;
                chatContainer.appendChild(messageDiv);
            });
            
            // Ïä§ÌÅ¨Î°§ ÌïòÎã®ÏúºÎ°ú
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Ï±ÑÌåÖ Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
            updateChatHistory();
        }
        
        function loadChatHistory() {
            const saved = localStorage.getItem('chatSessions');
            if (saved) {
                chatSessions = JSON.parse(saved);
                
                // Date Í∞ùÏ≤¥Î°ú Î≥ÄÌôò
                Object.keys(chatSessions).forEach(id => {
                    chatSessions[id].createdAt = new Date(chatSessions[id].createdAt);
                    chatSessions[id].updatedAt = new Date(chatSessions[id].updatedAt);
                });
            }
            updateChatHistory();
        }
        
        function updateChatHistory() {
            const historyList = document.getElementById('chatHistoryList');
            const sessions = Object.values(chatSessions)
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            if (sessions.length === 0) {
                historyList.innerHTML = `
                    <div class="chat-history-empty">
                        <i class="fas fa-comments"></i>
                        ÏïÑÏßÅ Ï±ÑÌåÖ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.
                    </div>`;
                return;
            }
            
            historyList.innerHTML = sessions.map(session => {
                const isActive = session.id === currentChatId;
                const timeStr = formatChatTime(session.updatedAt);
                const preview = getChatPreview(session.messages);
                
                return `
                    <div class="chat-history-item ${isActive ? 'active' : ''}" 
                         onclick="loadChatSession('${session.id}')">
                        <div class="chat-history-title">${session.title}</div>
                        <div class="chat-history-time">${timeStr}</div>
                        ${preview ? `<div class="chat-history-preview">${preview}</div>` : ''}
                    </div>`;
            }).join('');
        }
        
        function formatChatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'Î∞©Í∏à Ï†Ñ';
            if (minutes < 60) return `${minutes}Î∂Ñ Ï†Ñ`;
            if (hours < 24) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            if (days < 7) return `${days}Ïùº Ï†Ñ`;
            
            return date.toLocaleDateString('ko-KR', {
                month: 'short',
                day: 'numeric'
            });
        }
        
        function getChatPreview(messages) {
            const lastAiMessage = messages.slice().reverse().find(msg => 
                msg.className && msg.className.includes('ai-message'));
            
            if (!lastAiMessage) return null;
            
            const text = lastAiMessage.content.replace(/<[^>]*>/g, '').trim();
            return text.length > 50 ? text.substring(0, 50) + '...' : text;
        }
        
        // Collapsible sections
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId + 'Icon');
            
            content.classList.toggle('collapsed');
            icon.classList.toggle('rotated');
        }
        
        // Close settings dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const settingsContainer = document.querySelector('.settings-container');
            const dropdown = document.getElementById('chatSettingsDropdown');
            const chevron = document.getElementById('settingsChevron');
            
            if (settingsContainer && !settingsContainer.contains(event.target)) {
                if (dropdown) {
                    dropdown.style.display = 'none';
                    chevron.style.transform = 'rotate(0deg)';
                }
            }
        });
        // Chat Session Management
        let currentChatId = null;
        let chatSessions = {};
        let sessionCounter = 1;
        
        // Admin Settings Functions
        let adminToken = null;
        
        function showAdminLogin() {
            document.getElementById('adminModal').style.display = 'block';
        }
        
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }
        
        async function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (!password) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    adminToken = data.token;
                    document.getElementById('adminLoginForm').style.display = 'none';
                    document.getElementById('adminSettingsPanel').style.display = 'block';
                    await loadAdminSettings();
                } else {
                    alert(data.error || 'Î°úÍ∑∏Ïù∏ Ïã§Ìå®');
                }
                
            } catch (error) {
                alert('Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }
        
        function adminLogout() {
            adminToken = null;
            document.getElementById('adminLoginForm').style.display = 'block';
            document.getElementById('adminSettingsPanel').style.display = 'none';
            closeAdminModal();
        }
        
        function switchAdminTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        async function loadAdminSettings() {
            if (!adminToken) return;
            
            try {
                const response = await fetch('/api/admin/settings', {
                    headers: { 'Authorization': 'Bearer ' + adminToken }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Load cache settings (hybrid)
                    document.getElementById('popularThreshold').value = data.cache_config?.popular_threshold || 5;
                    document.getElementById('cacheTTL').value = data.cache_config?.ttl_hours || 24;
                    document.getElementById('currentCacheType').textContent = data.current_cache_type || 'hybrid';
                    
                    // Load chunk settings
                    document.getElementById('chunkSize').value = data.chunk_strategy?.chunk_size || 1000;
                    document.getElementById('chunkOverlap').value = data.chunk_strategy?.chunk_overlap || 200;
                    document.getElementById('chunkSeparator').value = data.chunk_strategy?.separator || '\\n\\n';
                    
                    // Load Redis settings
                    document.getElementById('redisHost').value = data.redis_config?.host || 'localhost';
                    document.getElementById('redisPort').value = data.redis_config?.port || 6379;
                    // Don't load password for security
                    
                } else {
                    alert('ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('ÏÑ§Ï†ï Î°úÎìú Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function saveAdminSettings() {
            if (!adminToken) return;
            
            const settings = {
                cache_type: 'hybrid',  // Always hybrid now
                cache_config: {
                    ttl_hours: parseInt(document.getElementById('cacheTTL').value),
                    popular_threshold: parseInt(document.getElementById('popularThreshold').value)
                },
                chunk_strategy: {
                    chunk_size: parseInt(document.getElementById('chunkSize').value),
                    chunk_overlap: parseInt(document.getElementById('chunkOverlap').value),
                    separator: document.getElementById('chunkSeparator').value
                },
                redis_config: {
                    host: document.getElementById('redisHost').value,
                    port: parseInt(document.getElementById('redisPort').value),
                    password: document.getElementById('redisPassword').value || null
                }
            };
            
            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + adminToken
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                    document.getElementById('currentCacheType').textContent = data.settings?.current_cache_type || settings.cache_type;
                } else {
                    alert('ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function switchCacheType() {
            const cacheType = document.getElementById('cacheType').value;
            
            try {
                const response = await fetch('/api/admin/cache/switch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + adminToken
                    },
                    body: JSON.stringify({ cache_type: cacheType })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('currentCacheType').textContent = data.current_type;
                    alert(data.message);
                } else {
                    alert('Ï∫êÏãú Ï†ÑÌôò Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('Ï∫êÏãú Ï†ÑÌôò Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function testRedisConnection() {
            const config = {
                host: document.getElementById('redisHost').value,
                port: parseInt(document.getElementById('redisPort').value),
                password: document.getElementById('redisPassword').value || null
            };
            
            try {
                const response = await fetch('/api/admin/cache/test-redis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + adminToken
                    },
                    body: JSON.stringify(config)
                });
                
                const data = await response.json();
                const resultDiv = document.getElementById('redisTestResult');
                
                if (data.connected) {
                    resultDiv.innerHTML = '‚úÖ ' + data.message;
                    resultDiv.className = 'test-success';
                } else {
                    resultDiv.innerHTML = '‚ùå ' + data.message;
                    resultDiv.className = 'test-fail';
                }
                
            } catch (error) {
                const resultDiv = document.getElementById('redisTestResult');
                resultDiv.innerHTML = '‚ùå Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•ò: ' + error.message;
                resultDiv.className = 'test-fail';
            }
        }
        
        async function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword || !confirmPassword) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§');
                return;
            }
            
            try {
                const response = await fetch('/api/admin/password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + adminToken
                    },
                    body: JSON.stringify({ new_password: newPassword })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§');
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function validateDocuments() {
            if (!adminToken) return;
            
            try {
                const response = await fetch('/api/admin/cache/validate-documents', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const result = data.result;
                    let message = `Î¨∏ÏÑú Í≤ÄÏ¶ù ÏôÑÎ£å!\n`;
                    message += `‚Ä¢ ÌôïÏù∏Îêú Î¨∏ÏÑú: ${result.documents_checked}Í∞ú\n`;
                    message += `‚Ä¢ Î≥ÄÍ≤Ω Í∞êÏßÄ: ${result.changes_detected}Í∞ú\n`;
                    message += `‚Ä¢ ÏÇ≠Ï†úÎêú Ï∫êÏãú: ${result.cache_cleared}Í∞ú`;
                    
                    alert(message);
                } else {
                    alert('Î¨∏ÏÑú Í≤ÄÏ¶ù Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('Î¨∏ÏÑú Í≤ÄÏ¶ù Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        async function loadCacheStats() {
            if (!adminToken) return;
            
            try {
                const response = await fetch('/api/admin/cache/hybrid-stats', {
                    headers: {
                        'Authorization': 'Bearer ' + adminToken
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayCacheStats(data);
                } else {
                    alert('Ï∫êÏãú ÌÜµÍ≥Ñ Î°úÎìú Ïã§Ìå®: ' + (data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                alert('Ï∫êÏãú ÌÜµÍ≥Ñ Î°úÎìú Ï§ë Ïò§Î•ò: ' + error.message);
            }
        }
        
        function displayCacheStats(stats) {
            const display = document.getElementById('cacheStatsDisplay');
            
            let html = '<h4>üìä ÌïòÏù¥Î∏åÎ¶¨Îìú Ï∫êÏãú ÌÜµÍ≥Ñ</h4>';
            
            html += '<div class="stats-grid">';
            
            // Redis stats
            if (stats.redis_cache) {
                html += `<div class="stats-card">
                    <h4>Redis Ï∫êÏãú (ÏûÑÏãú)</h4>
                    <div class="stats-number">${stats.redis_cache.total_entries || 0}</div>
                    <small>Í∞ú Ìï≠Î™© (Ï°∞Ìöå: ${stats.redis_cache.total_hits || 0}Ìöå)</small>
                </div>`;
            }
            
            // Popular cache stats
            if (stats.popular_cache) {
                html += `<div class="stats-card">
                    <h4>Ïù∏Í∏∞ ÏßàÎ¨∏ DB (ÏòÅÍµ¨)</h4>
                    <div class="stats-number">${stats.popular_cache.total_entries || 0}</div>
                    <small>Í∞ú Ìï≠Î™© (Ï°∞Ìöå: ${stats.popular_cache.total_hits || 0}Ìöå)</small>
                </div>`;
            }
            
            html += '</div>';
            
            // Validation history
            if (stats.validation_history && stats.validation_history.length > 0) {
                html += '<h5>üîç ÏµúÍ∑º Î¨∏ÏÑú Í≤ÄÏ¶ù Í∏∞Î°ù</h5>';
                html += '<div style="max-height: 150px; overflow-y: auto;">';
                
                stats.validation_history.forEach(record => {
                    const date = new Date(record.date).toLocaleString('ko-KR');
                    html += `<div style="padding: 5px 0; border-bottom: 1px solid #eee;">
                        <small>${date}: ${record.checked}Í∞ú ÌôïÏù∏, ${record.changes}Í∞ú Î≥ÄÍ≤Ω</small>
                    </div>`;
                });
                
                html += '</div>';
            }
            
            // Cache strategy info
            if (stats.cache_strategy) {
                html += '<h5>‚öôÔ∏è Ï∫êÏãú Ï†ÑÎûµ</h5>';
                html += `<p><small>
                    ‚Ä¢ Redis TTL: ${stats.cache_strategy.redis_ttl}<br>
                    ‚Ä¢ Ïù∏Í∏∞ Í∏∞Ï§Ä: ${stats.cache_strategy.popular_threshold}<br>
                    ‚Ä¢ Í≤ÄÏ¶ù Ï£ºÍ∏∞: ${stats.cache_strategy.validation_interval}
                </small></p>`;
            }
            
            display.innerHTML = html;
            display.style.display = 'block';
        }

    </script>
</body>
</html>