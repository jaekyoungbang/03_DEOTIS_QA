# RAG QA System - 상세 설명서

## 📚 임베딩과 청킹 이해하기

### 🔤 임베딩(Embedding)이란?
임베딩은 **텍스트를 숫자 벡터로 변환하는 과정**입니다.

#### 예시:
- 텍스트: "장기카드대출이란?"
- 임베딩 후: `[0.1, -0.3, 0.7, 0.2, ...]` (1536차원 벡터)

#### 왜 필요한가?
- 컴퓨터가 텍스트의 **의미를 이해**할 수 있게 함
- 비슷한 의미의 문장들은 **비슷한 벡터값**을 가짐
- 검색 시 **의미적 유사도**를 계산 가능

### ✂️ 청킹(Chunking)이란?
긴 문서를 **작은 조각들로 나누는 과정**입니다.

#### 설정값:
- **청크 크기(Chunk Size)**: 각 조각의 최대 문자 수 (기본: 1000자)
- **청크 겹침(Chunk Overlap)**: 인접한 조각 간의 겹치는 부분 (기본: 200자)

#### 예시:
원본 문서 (2000자) → 청크1 (1000자) + 청크2 (800자 + 200자 겹침)

#### 왜 필요한가?
- LLM의 **입력 길이 제한** 때문
- 정확한 검색을 위해 **적절한 크기로 분할** 필요

## 🗄️ 벡터 데이터베이스 작동 원리

### 1. 문서 저장 과정
```
원본 문서 → 청킹 → 임베딩 → 벡터DB 저장
```

### 2. 검색 과정
```
사용자 질문 → 임베딩 → 벡터DB 검색 → 유사한 청크 반환 → LLM 답변 생성
```

### 3. ChromaDB 구조
- **Collection**: 문서들의 그룹 (우리는 'rag_documents' 사용)
- **Vector**: 각 청크의 임베딩 벡터
- **Metadata**: 파일명, 청크 번호 등 부가 정보
- **Document**: 원본 텍스트 내용

## 🔧 시스템 설정 가이드

### LLM 모델 선택
- **GPT-4o-mini**: 빠르고 경제적, 일반적인 질문에 적합
- **GPT-4.1-mini**: 더 정확하고 복잡한 추론, 중요한 질문에 적합

### 청킹 설정 가이드
| 문서 유형 | 청크 크기 | 청크 겹침 | 이유 |
|---------|---------|---------|-----|
| 일반 문서 | 1000 | 200 | 균형잡힌 설정 |
| 짧은 FAQ | 500 | 100 | 세분화된 검색 |
| 긴 매뉴얼 | 1500 | 300 | 맥락 보존 |
| 표/데이터 | 800 | 150 | 구조 유지 |

### 임베딩 모델 비교
- **text-embedding-3-small**: 빠르고 경제적 (OpenAI)
- **text-embedding-3-large**: 더 정확한 의미 이해 (OpenAI)
- **all-MiniLM-L6-v2**: 무료, 로컬 사용 가능

## 🎯 사용법 가이드

### 1. 문서 업로드 방법
- **파일 업로드**: PDF, DOCX, TXT, MD 지원
- **S3 자동 로드**: 미리 준비된 문서들 일괄 로드
- **텍스트 직접 입력**: 짧은 텍스트 즉시 추가

### 2. 질문하기 팁
- **구체적으로**: "장기대출 신청방법" (O) vs "대출" (X)
- **맥락 포함**: "BC카드 장기카드대출 한도는?" 
- **단계적 질문**: 복잡한 내용은 여러 번에 나눠서

### 3. 답변 품질 향상 방법
- **충분한 문서**: 관련 문서를 많이 업로드
- **적절한 청킹**: 문서 특성에 맞는 설정
- **모델 선택**: 중요한 질문은 GPT-4 사용

## ⚙️ 고급 활용법

### API 사용하기
```bash
# 질문하기
curl -X POST http://localhost:5000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"question": "장기카드대출이란?", "llm_model": "gpt-4o-mini"}'

# 문서 업로드
curl -X POST http://localhost:5000/api/v1/documents/upload-text \
  -H "Content-Type: application/json" \
  -d '{"text": "새로운 정보...", "title": "업데이트"}'
```

### 벡터DB 관리
- **정기적 정리**: 오래된 문서 삭제
- **중복 제거**: 같은 내용 여러 번 업로드 방지  
- **백업**: 중요한 데이터는 주기적 백업

## 🚨 문제 해결

### 검색이 안 될 때
1. 문서가 제대로 업로드되었는지 확인
2. 질문을 다르게 표현해보기
3. 청크 크기를 줄여서 재업로드

### 답변이 부정확할 때
1. 더 구체적인 문서 추가
2. LLM 모델을 GPT-4로 변경
3. 질문을 더 명확하게 표현

### 시스템이 느릴 때
1. 청크 크기를 늘려서 청크 수 줄이기
2. GPT-4o-mini 사용
3. 불필요한 문서 삭제

이 시스템은 **학습이 아닌 검색 기반**입니다. 새로운 정보를 추가하려면 문서를 업로드하면 즉시 반영됩니다!